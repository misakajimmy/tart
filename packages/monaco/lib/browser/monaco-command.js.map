{"version":3,"sources":["browser/monaco-command.ts"],"names":[],"mappings":"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","file":"../../src/browser/monaco-command.js","sourcesContent":["import {inject, injectable, optional} from 'inversify';\r\nimport {CommandContribution, CommandHandler, CommandRegistry} from '@tart/core/lib/common';\r\nimport {MonacoEditorService} from './monaco-editor-service';\r\nimport {CommonCommands} from '@tart/core';\r\nimport {MonacoCommandRegistry, MonacoEditorCommandHandler} from './monaco-command-registry';\r\nimport {ProtocolToMonacoConverter} from './protocol-to-monaco-converter';\r\nimport {QuickInputService} from '@tart/core/lib/common/quick-pick-service';\r\nimport {MonacoTextModelService} from './monaco-text-model-service';\r\nimport {ApplicationShell} from '@tart/core/lib/browser';\r\nimport {MonacoEditor} from './monaco-editor';\r\nimport {Location, Position} from 'vscode-languageserver-types';\r\nimport {nls} from '@tart/core/lib/common/nls';\r\nimport {EditorManager} from '@tart/editor/lib/browser/editor-manager';\r\nimport {EditorCommands} from '@tart/editor/lib/browser/editor-command';\r\nimport {EditorWidget} from '@tart/editor/lib/browser/editor-widget';\r\n\r\nexport namespace MonacoCommands {\r\n\r\n  export const COMMON_ACTIONS = new Map<string, string>([\r\n    ['undo', CommonCommands.UNDO.id],\r\n    ['redo', CommonCommands.REDO.id],\r\n    ['editor.action.selectAll', CommonCommands.SELECT_ALL.id],\r\n    ['actions.find', CommonCommands.FIND.id],\r\n    ['editor.action.startFindReplaceAction', CommonCommands.REPLACE.id]\r\n  ]);\r\n\r\n  export const GO_TO_DEFINITION = 'editor.action.revealDefinition';\r\n\r\n  export const EXCLUDE_ACTIONS = new Set([\r\n    'editor.action.quickCommand',\r\n    'editor.action.clipboardCutAction',\r\n    'editor.action.clipboardCopyAction',\r\n    'editor.action.clipboardPasteAction'\r\n  ]);\r\n}\r\n\r\n\r\n@injectable()\r\nexport class MonacoEditorCommandHandlers implements CommandContribution {\r\n\r\n  @inject(MonacoCommandRegistry)\r\n  protected readonly monacoCommandRegistry: MonacoCommandRegistry;\r\n\r\n  @inject(CommandRegistry)\r\n  protected readonly commandRegistry: CommandRegistry;\r\n\r\n  @inject(ProtocolToMonacoConverter)\r\n  protected readonly p2m: ProtocolToMonacoConverter;\r\n\r\n  @inject(QuickInputService) @optional()\r\n  protected readonly quickInputService: QuickInputService;\r\n\r\n  @inject(MonacoEditorService)\r\n  protected readonly codeEditorService: MonacoEditorService;\r\n\r\n  @inject(MonacoTextModelService)\r\n  protected readonly textModelService: MonacoTextModelService;\r\n\r\n  @inject(monaco.contextKeyService.ContextKeyService)\r\n  protected readonly contextKeyService: monaco.contextKeyService.ContextKeyService;\r\n\r\n  @inject(ApplicationShell)\r\n  protected readonly shell: ApplicationShell;\r\n\r\n  @inject(EditorManager)\r\n  protected editorManager: EditorManager;\r\n\r\n  registerCommands(): void {\r\n    this.registerMonacoCommands();\r\n    this.registerEditorCommandHandlers();\r\n  }\r\n\r\n  /**\r\n   * Register commands from Monaco to Wm registry.\r\n   *\r\n   * Monaco has different kind of commands which should be handled differently by Wm.\r\n   *\r\n   * ### Editor Actions\r\n   *\r\n   * They should be registered with a label to be visible in the quick command palette.\r\n   *\r\n   * Such actions should be enabled only if the current editor is available and\r\n   * it supports such action in the current context.\r\n   *\r\n   * ### Editor Commands\r\n   *\r\n   * Such actions should be enabled only if the current editor is available.\r\n   *\r\n   * `actions.find` and `editor.action.startFindReplaceAction` are registered as handlers for `find` and `replace`.\r\n   * If handlers are not enabled then the core should prevent the default browser behavior.\r\n   * Other Wm extensions can register alternative implementations using custom enablement.\r\n   *\r\n   * ### Global Commands\r\n   *\r\n   * These commands are not necessary dependent on the current editor and enabled always.\r\n   * But they depend on services which are global in VS Code, but bound to the editor in Monaco,\r\n   * i.e. `ICodeEditorService` or `IContextKeyService`. We should take care of providing Wm implementations for such services.\r\n   *\r\n   * #### Global Native or Editor Commands\r\n   *\r\n   * Namely: `undo`, `redo` and `editor.action.selectAll`. They depend on `ICodeEditorService`.\r\n   * They will try to delegate to the current editor and if it is not available delegate to the browser.\r\n   * They are registered as handlers for corresponding core commands always.\r\n   * Other Wm extensions can provide alternative implementations by introducing a dependency to `@wm/monaco` extension.\r\n   *\r\n   * #### Global Language Commands\r\n   *\r\n   * Like `_executeCodeActionProvider`, they depend on `ICodeEditorService` and `ITextModelService`.\r\n   *\r\n   * #### Global Context Commands\r\n   *\r\n   * It is `setContext`. It depends on `IContextKeyService`.\r\n   *\r\n   * #### Global Editor Commands\r\n   *\r\n   * Like `openReferenceToSide` and `openReference`, they depend on `IListService`.\r\n   * We treat all commands which don't match any other category of global commands as global editor commands\r\n   * and execute them using the instantiation service of the current editor.\r\n   */\r\n  protected registerMonacoCommands(): void {\r\n    const editorRegistry = monaco.editorExtensions.EditorExtensionsRegistry;\r\n    const editorActions = new Map(editorRegistry.getEditorActions().map(({id, label}) => [id, label]));\r\n\r\n    const {codeEditorService, textModelService, contextKeyService} = this;\r\n    const [, globalInstantiationService] = monaco.services.StaticServices.init({\r\n      codeEditorService,\r\n      textModelService,\r\n      contextKeyService\r\n    });\r\n    const monacoCommands = monaco.commands.CommandsRegistry.getCommands();\r\n    for (const id of monacoCommands.keys()) {\r\n      if (MonacoCommands.EXCLUDE_ACTIONS.has(id)) {\r\n        continue;\r\n      }\r\n      const handler: CommandHandler = {\r\n        execute: (...args) => {\r\n          /*\r\n           * We check monaco focused code editor first since they can contain inline like the debug console and embedded editors like in the peek reference.\r\n           * If there is not such then we check last focused editor tracked by us.\r\n           */\r\n          const editor = codeEditorService.getFocusedCodeEditor() || codeEditorService.getActiveCodeEditor();\r\n          if (editorActions.has(id)) {\r\n            const action = editor && editor.getAction(id);\r\n            if (!action) {\r\n              return;\r\n            }\r\n            return action.run();\r\n          }\r\n          const editorCommand = !!editorRegistry.getEditorCommand(id) ||\r\n              !(id.startsWith('_execute') || id === 'setContext' || MonacoCommands.COMMON_ACTIONS.has(id));\r\n          const instantiationService = editorCommand ? editor && editor['_instantiationService'] : globalInstantiationService;\r\n          if (!instantiationService) {\r\n            return;\r\n          }\r\n          return instantiationService.invokeFunction(\r\n              monacoCommands.get(id)!.handler,\r\n              ...args\r\n          );\r\n        },\r\n        isEnabled: () => {\r\n          const editor = codeEditorService.getFocusedCodeEditor() || codeEditorService.getActiveCodeEditor();\r\n\r\n          if (editorActions.has(id)) {\r\n            const action = editor && editor.getAction(id);\r\n            return !!action && action.isSupported();\r\n          }\r\n          if (!!editorRegistry.getEditorCommand(id)) {\r\n            return !!editor;\r\n          }\r\n          return true;\r\n        }\r\n      };\r\n      const label = editorActions.get(id);\r\n      this.commandRegistry.registerCommand({id, label}, handler);\r\n      const coreCommand = MonacoCommands.COMMON_ACTIONS.get(id);\r\n      if (coreCommand) {\r\n        this.commandRegistry.registerHandler(coreCommand, handler);\r\n      }\r\n    }\r\n  }\r\n\r\n  protected registerEditorCommandHandlers(): void {\r\n    this.monacoCommandRegistry.registerHandler(EditorCommands.SHOW_REFERENCES.id, this.newShowReferenceHandler());\r\n    this.monacoCommandRegistry.registerHandler(EditorCommands.CONFIG_INDENTATION.id, this.newConfigIndentationHandler());\r\n    this.monacoCommandRegistry.registerHandler(EditorCommands.CONFIG_EOL.id, this.newConfigEolHandler());\r\n    this.monacoCommandRegistry.registerHandler(EditorCommands.INDENT_USING_SPACES.id, this.newConfigTabSizeHandler(true));\r\n    this.monacoCommandRegistry.registerHandler(EditorCommands.INDENT_USING_TABS.id, this.newConfigTabSizeHandler(false));\r\n    this.monacoCommandRegistry.registerHandler(EditorCommands.REVERT_EDITOR.id, this.newRevertActiveEditorHandler());\r\n    this.monacoCommandRegistry.registerHandler(EditorCommands.REVERT_AND_CLOSE.id, this.newRevertAndCloseActiveEditorHandler());\r\n  }\r\n\r\n  protected newShowReferenceHandler(): MonacoEditorCommandHandler {\r\n    return {\r\n      execute: (editor: MonacoEditor, uri: string, position: Position, locations: Location[]) => {\r\n        editor.commandService.executeCommand(\r\n            'editor.action.showReferences',\r\n            monaco.Uri.parse(uri),\r\n            this.p2m.asPosition(position),\r\n            locations.map(l => this.p2m.asLocation(l as Location))\r\n        );\r\n      }\r\n    };\r\n  }\r\n\r\n  protected newConfigIndentationHandler(): MonacoEditorCommandHandler {\r\n    return {\r\n      execute: editor => this.configureIndentation(editor)\r\n    };\r\n  }\r\n\r\n  protected configureIndentation(editor: MonacoEditor): void {\r\n    const items = [true, false].map(useSpaces => ({\r\n      label: nls.localize(`vscode/indentation/indentUsing${useSpaces ? 'Spaces' : 'Tabs'}`, `Indent Using ${useSpaces ? 'Spaces' : 'Tabs'}`),\r\n      execute: () => this.configureTabSize(editor, useSpaces)\r\n    }));\r\n    this.quickInputService?.showQuickPick(items, {placeholder: nls.localizeByDefault('Select Action')});\r\n  }\r\n\r\n  protected newConfigEolHandler(): MonacoEditorCommandHandler {\r\n    return {\r\n      execute: editor => this.configureEol(editor)\r\n    };\r\n  }\r\n\r\n  protected configureEol(editor: MonacoEditor): void {\r\n    const items = ['LF', 'CRLF'].map(lineEnding =>\r\n        ({\r\n          label: lineEnding,\r\n          execute: () => this.setEol(editor, lineEnding)\r\n        })\r\n    );\r\n    this.quickInputService?.showQuickPick(items, {placeholder: nls.localizeByDefault('Select End of Line Sequence')});\r\n  }\r\n\r\n  protected setEol(editor: MonacoEditor, lineEnding: string): void {\r\n    const model = editor.document && editor.document.textEditorModel;\r\n    if (model) {\r\n      if (lineEnding === 'CRLF' || lineEnding === '\\r\\n') {\r\n        model.pushEOL(monaco.editor.EndOfLineSequence.CRLF);\r\n      } else {\r\n        model.pushEOL(monaco.editor.EndOfLineSequence.LF);\r\n      }\r\n    }\r\n  }\r\n\r\n  protected newConfigTabSizeHandler(useSpaces: boolean): MonacoEditorCommandHandler {\r\n    return {\r\n      execute: editor => this.configureTabSize(editor, useSpaces)\r\n    };\r\n  }\r\n\r\n  protected configureTabSize(editor: MonacoEditor, useSpaces: boolean): void {\r\n    const model = editor.document && editor.document.textEditorModel;\r\n    if (model) {\r\n      const {tabSize} = model.getOptions();\r\n      const sizes = Array.from(Array(8), (_, x) => x + 1);\r\n      const tabSizeOptions = sizes.map(size =>\r\n          ({\r\n            label: size === tabSize ? size + '   ' + nls.localizeByDefault('Configured Tab Size') : size.toString(),\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            execute: () => model.updateOptions({\r\n              tabSize: size || tabSize,\r\n              insertSpaces: useSpaces\r\n            })\r\n          })\r\n      );\r\n      this.quickInputService?.showQuickPick(tabSizeOptions, {placeholder: nls.localizeByDefault('Select Tab Size for Current File')});\r\n    }\r\n  }\r\n\r\n  protected newRevertActiveEditorHandler(): MonacoEditorCommandHandler {\r\n    return {\r\n      execute: () => this.revertEditor(this.getActiveEditor().editor),\r\n    };\r\n  }\r\n\r\n  protected newRevertAndCloseActiveEditorHandler(): MonacoEditorCommandHandler {\r\n    return {\r\n      execute: async () => this.revertAndCloseActiveEditor(this.getActiveEditor())\r\n    };\r\n  }\r\n\r\n  protected getActiveEditor(): { widget?: EditorWidget, editor?: MonacoEditor } {\r\n    const widget = this.editorManager.currentEditor;\r\n    return {widget, editor: widget && MonacoEditor.getCurrent(this.editorManager)};\r\n  }\r\n\r\n  protected async revertEditor(editor?: MonacoEditor): Promise<void> {\r\n    if (editor) {\r\n      return editor.document.revert();\r\n    }\r\n  }\r\n\r\n  protected async revertAndCloseActiveEditor(current: { widget?: EditorWidget, editor?: MonacoEditor }): Promise<void> {\r\n    if (current.editor && current.widget) {\r\n      try {\r\n        await this.revertEditor(current.editor);\r\n        current.widget.close();\r\n      } catch (error) {\r\n        await this.shell.closeWidget(current.widget.id, {save: false});\r\n      }\r\n    }\r\n  }\r\n}\r\n"]}