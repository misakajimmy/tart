{"version":3,"sources":["browser/editor-manager.ts"],"names":[],"mappings":"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","file":"../../src/browser/editor-manager.js","sourcesContent":["import {injectable, postConstruct} from 'inversify';\r\nimport {EditorWidget} from './editor-widget';\r\nimport {NavigatableWidgetOpenHandler, NavigatableWidgetOptions, Widget, WidgetOpenerOptions} from '@tart/core';\r\nimport {Emitter, Event, MaybePromise, RecursivePartial} from '@tart/core/lib/common';\r\nimport {EditorWidgetFactory} from './editor-widget-factory';\r\nimport {Position, Range} from './editor';\r\nimport URI from '@tart/core/lib/common/uri';\r\n\r\nexport interface WidgetId {\r\n  id: number;\r\n  uri: string;\r\n}\r\n\r\nexport interface EditorOpenerOptions extends WidgetOpenerOptions {\r\n  selection?: RecursivePartial<Range>;\r\n  preview?: boolean;\r\n  counter?: number\r\n}\r\n\r\n@injectable()\r\nexport class EditorManager extends NavigatableWidgetOpenHandler<EditorWidget> {\r\n\r\n  readonly id = EditorWidgetFactory.ID;\r\n\r\n  readonly label = 'Code Editor';\r\n\r\n  protected readonly editorCounters = new Map<string, number>();\r\n\r\n  protected readonly onActiveEditorChangedEmitter = new Emitter<EditorWidget | undefined>();\r\n  /**\r\n   * Emit when the active editor is changed.\r\n   */\r\n  readonly onActiveEditorChanged: Event<EditorWidget | undefined> = this.onActiveEditorChangedEmitter.event;\r\n\r\n  protected readonly onCurrentEditorChangedEmitter = new Emitter<EditorWidget | undefined>();\r\n  /**\r\n   * Emit when the current editor is changed.\r\n   */\r\n  readonly onCurrentEditorChanged: Event<EditorWidget | undefined> = this.onCurrentEditorChangedEmitter.event;\r\n  protected readonly recentlyVisibleIds: string[] = [];\r\n\r\n  protected _activeEditor: EditorWidget | undefined;\r\n\r\n  /**\r\n   * The active editor.\r\n   * If there is an active editor (one that has focus), active and current are the same.\r\n   */\r\n  get activeEditor(): EditorWidget | undefined {\r\n    return this._activeEditor;\r\n  }\r\n\r\n  protected _currentEditor: EditorWidget | undefined;\r\n\r\n  /**\r\n   * The most recently activated editor (which might not have the focus anymore, hence it is not active).\r\n   * If no editor has focus, e.g. when a context menu is shown, the active editor is `undefined`, but current might be the editor that was active before the menu popped up.\r\n   */\r\n  get currentEditor(): EditorWidget | undefined {\r\n    return this._currentEditor;\r\n  }\r\n\r\n  protected get recentlyVisible(): EditorWidget | undefined {\r\n    const id = this.recentlyVisibleIds[0];\r\n    return id && this.all.find(w => w.id === id) || undefined;\r\n  }\r\n\r\n  getByUri(uri: URI, options?: EditorOpenerOptions): Promise<EditorWidget | undefined> {\r\n    return this.getWidget(uri, options);\r\n  }\r\n\r\n  getOrCreateByUri(uri: URI, options?: EditorOpenerOptions): Promise<EditorWidget> {\r\n    return this.getOrCreateWidget(uri, options);\r\n  }\r\n\r\n  canHandle(uri: URI, options?: WidgetOpenerOptions): number {\r\n    return 100;\r\n  }\r\n\r\n  // This override only serves to inform external callers that they can use EditorOpenerOptions.\r\n  open(uri: URI, options?: EditorOpenerOptions): Promise<EditorWidget> {\r\n    return super.open(uri, options);\r\n  }\r\n\r\n  /**\r\n   * Opens an editor to the side of the current editor. Defaults to opening to the right.\r\n   * To modify direction, pass options with `{widgetOptions: {mode: ...}}`\r\n   */\r\n  openToSide(uri: URI, options?: EditorOpenerOptions): Promise<EditorWidget> {\r\n    const counter = this.createCounterForUri(uri);\r\n    const splitOptions: EditorOpenerOptions = {widgetOptions: {mode: 'split-right'}, ...options, counter};\r\n    return this.open(uri, splitOptions);\r\n  }\r\n\r\n  @postConstruct()\r\n  protected init(): void {\r\n    super.init();\r\n    this.shell.onDidChangeActiveWidget(() => this.updateActiveEditor());\r\n    this.shell.onDidChangeCurrentWidget(() => this.updateCurrentEditor());\r\n    this.onCreated(widget => {\r\n      widget.onDidChangeVisibility(() => {\r\n        if (widget.isVisible) {\r\n          this.addRecentlyVisible(widget);\r\n        }\r\n        this.updateCurrentEditor();\r\n      });\r\n      this.checkCounterForWidget(widget);\r\n      widget.disposed.connect(() => {\r\n        this.removeFromCounter(widget);\r\n        this.removeRecentlyVisible(widget);\r\n        this.updateCurrentEditor();\r\n      });\r\n    });\r\n    for (const widget of this.all) {\r\n      if (widget.isVisible) {\r\n        this.addRecentlyVisible(widget);\r\n      }\r\n    }\r\n    this.updateCurrentEditor();\r\n  }\r\n\r\n  protected tryGetPendingWidget(uri: URI, options?: EditorOpenerOptions): MaybePromise<EditorWidget> | undefined {\r\n    const editorPromise = super.tryGetPendingWidget(uri, options);\r\n    if (editorPromise) {\r\n      // Reveal selection before attachment to manage nav stack. (https://github.com/eclipse-wm/wm/issues/8955)\r\n      if (!(editorPromise instanceof Widget)) {\r\n        editorPromise.then(editor => this.revealSelection(editor, options, uri));\r\n      } else {\r\n        this.revealSelection(editorPromise, options);\r\n      }\r\n    }\r\n    return editorPromise;\r\n  }\r\n\r\n  protected async getWidget(uri: URI, options?: EditorOpenerOptions): Promise<EditorWidget | undefined> {\r\n    const editor = await super.getWidget(uri, options);\r\n    if (editor) {\r\n      // Reveal selection before attachment to manage nav stack. (https://github.com/eclipse-wm/wm/issues/8955)\r\n      this.revealSelection(editor, options, uri);\r\n    }\r\n    return editor;\r\n  }\r\n\r\n  protected async getOrCreateWidget(uri: URI, options?: EditorOpenerOptions): Promise<EditorWidget> {\r\n    const editor = await super.getOrCreateWidget(uri, options);\r\n    // Reveal selection before attachment to manage nav stack. (https://github.com/eclipse-wm/wm/issues/8955)\r\n    this.revealSelection(editor, options, uri);\r\n    return editor;\r\n  }\r\n\r\n  protected addRecentlyVisible(widget: EditorWidget): void {\r\n    this.removeRecentlyVisible(widget);\r\n    this.recentlyVisibleIds.unshift(widget.id);\r\n  }\r\n\r\n  protected removeRecentlyVisible(widget: EditorWidget): void {\r\n    const index = this.recentlyVisibleIds.indexOf(widget.id);\r\n    if (index !== -1) {\r\n      this.recentlyVisibleIds.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  protected setActiveEditor(active: EditorWidget | undefined): void {\r\n    if (this._activeEditor !== active) {\r\n      this._activeEditor = active;\r\n      this.onActiveEditorChangedEmitter.fire(this._activeEditor);\r\n    }\r\n  }\r\n\r\n  protected updateActiveEditor(): void {\r\n    const widget = this.shell.activeWidget;\r\n    if (widget instanceof EditorWidget) {\r\n      this.addRecentlyVisible(widget);\r\n      this.setActiveEditor(widget);\r\n    } else {\r\n      this.setActiveEditor(undefined);\r\n    }\r\n  }\r\n\r\n  protected setCurrentEditor(current: EditorWidget | undefined): void {\r\n    if (this._currentEditor !== current) {\r\n      this._currentEditor = current;\r\n      this.onCurrentEditorChangedEmitter.fire(this._currentEditor);\r\n    }\r\n  }\r\n\r\n  protected updateCurrentEditor(): void {\r\n    const widget = this.shell.currentWidget;\r\n    if (widget instanceof EditorWidget) {\r\n      this.setCurrentEditor(widget);\r\n    } else if (!this._currentEditor || !this._currentEditor.isVisible || this.currentEditor !== this.recentlyVisible) {\r\n      this.setCurrentEditor(this.recentlyVisible);\r\n    }\r\n  }\r\n\r\n  protected revealSelection(widget: EditorWidget, input?: EditorOpenerOptions, uri?: URI): void {\r\n    let inputSelection = input?.selection;\r\n    if (!inputSelection && uri) {\r\n      const match = /^L?(\\d+)(?:,(\\d+))?/.exec(uri.fragment);\r\n      if (match) {\r\n        // support file:///some/file.js#73,84\r\n        // support file:///some/file.js#L73\r\n        inputSelection = {\r\n          start: {\r\n            line: parseInt(match[1]) - 1,\r\n            character: match[2] ? parseInt(match[2]) - 1 : 0\r\n          }\r\n        };\r\n      }\r\n    }\r\n    if (inputSelection) {\r\n      const editor = widget.editor;\r\n      const selection = this.getSelection(widget, inputSelection);\r\n      if (Position.is(selection)) {\r\n        editor.cursor = selection;\r\n        editor.revealPosition(selection);\r\n      } else if (Range.is(selection)) {\r\n        editor.cursor = selection.end;\r\n        editor.selection = selection;\r\n        editor.revealRange(selection);\r\n      }\r\n    }\r\n  }\r\n\r\n  protected getSelection(widget: EditorWidget, selection: RecursivePartial<Range>): Range | Position | undefined {\r\n    const {start, end} = selection;\r\n    const line = start && start.line !== undefined && start.line >= 0 ? start.line : undefined;\r\n    if (line === undefined) {\r\n      return undefined;\r\n    }\r\n    const character = start && start.character !== undefined && start.character >= 0 ? start.character : widget.editor.document.getLineMaxColumn(line);\r\n    const endLine = end && end.line !== undefined && end.line >= 0 ? end.line : undefined;\r\n    if (endLine === undefined) {\r\n      return {line, character};\r\n    }\r\n    const endCharacter = end && end.character !== undefined && end.character >= 0 ? end.character : widget.editor.document.getLineMaxColumn(endLine);\r\n    return {\r\n      start: {line, character},\r\n      end: {line: endLine, character: endCharacter}\r\n    };\r\n  }\r\n\r\n  protected removeFromCounter(widget: EditorWidget): void {\r\n    const {id, uri} = this.extractIdFromWidget(widget);\r\n    if (uri && !Number.isNaN(id)) {\r\n      let max = -Infinity;\r\n      this.all.forEach(editor => {\r\n        const candidateID = this.extractIdFromWidget(editor);\r\n        if ((candidateID.uri === uri) && (candidateID.id > max)) {\r\n          max = candidateID.id!;\r\n        }\r\n      });\r\n\r\n      if (max > -Infinity) {\r\n        this.editorCounters.set(uri, max);\r\n      } else {\r\n        this.editorCounters.delete(uri);\r\n      }\r\n    }\r\n  }\r\n\r\n  protected extractIdFromWidget(widget: EditorWidget): WidgetId {\r\n    const uri = widget.editor.uri.toString();\r\n    const id = Number(widget.id.slice(widget.id.lastIndexOf(':') + 1));\r\n    return {id, uri};\r\n  }\r\n\r\n  protected checkCounterForWidget(widget: EditorWidget): void {\r\n    const {id, uri} = this.extractIdFromWidget(widget);\r\n    const numericalId = Number(id);\r\n    if (uri && !Number.isNaN(numericalId)) {\r\n      const highestKnownId = this.editorCounters.get(uri) ?? -Infinity;\r\n      if (numericalId > highestKnownId) {\r\n        this.editorCounters.set(uri, numericalId);\r\n      }\r\n    }\r\n  }\r\n\r\n  protected createCounterForUri(uri: URI): number {\r\n    const identifier = uri.toString();\r\n    const next = (this.editorCounters.get(identifier) ?? 0) + 1;\r\n    return next;\r\n  }\r\n\r\n  protected getCounterForUri(uri: URI): number | undefined {\r\n    const idWithoutCounter = EditorWidgetFactory.createID(uri);\r\n    const counterOfMostRecentlyVisibleEditor = this.recentlyVisibleIds.find(id => id.startsWith(idWithoutCounter))?.slice(idWithoutCounter.length + 1);\r\n    return counterOfMostRecentlyVisibleEditor === undefined ? undefined : parseInt(counterOfMostRecentlyVisibleEditor);\r\n  }\r\n\r\n  protected getOrCreateCounterForUri(uri: URI): number {\r\n    return this.getCounterForUri(uri) ?? this.createCounterForUri(uri);\r\n  }\r\n\r\n  protected createWidgetOptions(uri: URI, options?: EditorOpenerOptions): NavigatableWidgetOptions {\r\n    const navigatableOptions = super.createWidgetOptions(uri, options);\r\n    navigatableOptions.counter = options?.counter ?? this.getOrCreateCounterForUri(uri);\r\n    return navigatableOptions;\r\n  }\r\n}\r\n"]}