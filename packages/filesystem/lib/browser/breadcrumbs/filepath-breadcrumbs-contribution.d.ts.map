{"version":3,"sources":["browser/breadcrumbs/filepath-breadcrumbs-contribution.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,UAAU,EAAE,OAAO,EAAE,KAAK,EAAC,MAAM,uBAAuB,CAAC;AAEjE,OAAO,EACH,UAAU,EACV,uBAAuB,EAEvB,aAAa,EAGhB,MAAM,wBAAwB,CAAC;AAChC,OAAO,EAAC,kBAAkB,EAAC,MAAM,uBAAuB,CAAC;AACzD,OAAO,EAAC,yBAAyB,EAAC,MAAM,kCAAkC,CAAC;AAC3E,OAAO,EAAC,OAAO,EAAC,MAAM,cAAc,CAAC;AACrC,OAAO,EAAC,WAAW,EAAC,MAAM,iBAAiB,CAAC;AAC5C,OAAO,EAAC,QAAQ,EAAC,MAAM,oBAAoB,CAAC;AAC5C,OAAO,GAAG,MAAM,2BAA2B,CAAC;AAE5C,eAAO,MAAM,sBAAsB,eAA+B,CAAC;AAEnE,MAAM,WAAW,kCAAkC;IAC/C,CAAC,QAAQ,EAAE,GAAG,EAAE,KAAK,EAAE,MAAM,GAAG,MAAM,CAAC;CAC1C;AAED,qBACa,+BAAgC,YAAW,uBAAuB;IAE3E,QAAQ,CAAC,IAAI,SAA0B;IACvC,QAAQ,CAAC,QAAQ,EAAE,MAAM,CAAO;IAEhC,SAAS,CAAC,QAAQ,CAAC,aAAa,EAAE,aAAa,CAAC;IAEhD,SAAS,CAAC,QAAQ,CAAC,UAAU,EAAE,WAAW,CAAC;IAE3C,SAAS,CAAC,QAAQ,CAAC,yBAAyB,EAAE,yBAAyB,CAAC;IACxE,SAAS,CAAC,QAAQ,CAAC,6BAA6B,eAAsB;IAEtE,IAAI,sBAAsB,IAAI,KAAK,CAAC,GAAG,CAAC,CAEvC;IAEK,kBAAkB,CAAC,GAAG,EAAE,GAAG,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC;IAsBnD,kBAAkB,CAAC,UAAU,EAAE,UAAU,EAAE,MAAM,EAAE,WAAW,GAAG,OAAO,CAAC,UAAU,GAAG,SAAS,CAAC;IAkCtG,SAAS,CAAC,wBAAwB,CAAC,OAAO,EAAE,GAAG,GAAG,kCAAkC;IAIpF,SAAS,CAAC,mBAAmB,CAAC,OAAO,EAAE,GAAG,GAAG,kCAAkC;IAI/E,SAAS,CAAC,iBAAiB,CAAC,CAAC,EAAE,GAAG,EAAE,UAAU,EAAE,kBAAkB,GAAG,OAAO;cAI5D,cAAc,CAAC,YAAY,EAAE,QAAQ,GAAG,OAAO,CAAC,OAAO,GAAG,SAAS,CAAC;CAQvF","file":"../../../src/browser/breadcrumbs/filepath-breadcrumbs-contribution.d.ts","sourcesContent":["import {Disposable, Emitter, Event} from '@tart/core/lib/common';\r\nimport {inject, injectable} from 'inversify';\r\nimport {\r\n    Breadcrumb,\r\n    BreadcrumbsContribution,\r\n    CompositeTreeNode,\r\n    LabelProvider,\r\n    SelectableTreeNode,\r\n    Widget\r\n} from '@tart/core/lib/browser';\r\nimport {FilepathBreadcrumb} from './filepath-breadcrumb';\r\nimport {BreadcrumbsFileTreeWidget} from './filepath-breadcrumbs-container';\r\nimport {DirNode} from '../file-tree';\r\nimport {FileService} from '../file-service';\r\nimport {FileStat} from '../../common/files';\r\nimport URI from '@tart/core/lib/common/uri';\r\n\r\nexport const FilepathBreadcrumbType = Symbol('FilepathBreadcrumb');\r\n\r\nexport interface FilepathBreadcrumbClassNameFactory {\r\n    (location: URI, index: number): string;\r\n}\r\n\r\n@injectable()\r\nexport class FilepathBreadcrumbsContribution implements BreadcrumbsContribution {\r\n\r\n    readonly type = FilepathBreadcrumbType;\r\n    readonly priority: number = 100;\r\n    @inject(LabelProvider)\r\n    protected readonly labelProvider: LabelProvider;\r\n    @inject(FileService)\r\n    protected readonly fileSystem: FileService;\r\n    @inject(BreadcrumbsFileTreeWidget)\r\n    protected readonly breadcrumbsFileTreeWidget: BreadcrumbsFileTreeWidget;\r\n    protected readonly onDidChangeBreadcrumbsEmitter = new Emitter<URI>();\r\n\r\n    get onDidChangeBreadcrumbs(): Event<URI> {\r\n        return this.onDidChangeBreadcrumbsEmitter.event;\r\n    }\r\n\r\n    async computeBreadcrumbs(uri: URI): Promise<Breadcrumb[]> {\r\n        if (uri.scheme !== 'file') {\r\n            return [];\r\n        }\r\n        const getContainerClass = this.getContainerClassCreator(uri);\r\n        const getIconClass = this.getIconClassCreator(uri);\r\n        return uri.allLocations\r\n            .map((location, index) => {\r\n                const icon = getIconClass(location, index);\r\n                const containerClass = getContainerClass(location, index);\r\n                return new FilepathBreadcrumb(\r\n                    location,\r\n                    this.labelProvider.getName(location),\r\n                    this.labelProvider.getLongName(location),\r\n                    icon,\r\n                    containerClass,\r\n                );\r\n            })\r\n            .filter(b => this.filterBreadcrumbs(uri, b))\r\n            .reverse();\r\n    }\r\n\r\n    async attachPopupContent(breadcrumb: Breadcrumb, parent: HTMLElement): Promise<Disposable | undefined> {\r\n        if (!FilepathBreadcrumb.is(breadcrumb)) {\r\n            return undefined;\r\n        }\r\n        const folderFileStat = await this.fileSystem.resolve(breadcrumb.uri.parent);\r\n        if (folderFileStat) {\r\n            const rootNode = await this.createRootNode(folderFileStat);\r\n            if (rootNode) {\r\n                const {model} = this.breadcrumbsFileTreeWidget;\r\n                await model.navigateTo({...rootNode, visible: false});\r\n                Widget.attach(this.breadcrumbsFileTreeWidget, parent);\r\n                const toDisposeOnTreePopulated = model.onChanged(() => {\r\n                    if (CompositeTreeNode.is(model.root) && model.root.children.length > 0) {\r\n                        toDisposeOnTreePopulated.dispose();\r\n                        const targetNode = model.getNode(breadcrumb.uri.path.toString());\r\n                        if (targetNode && SelectableTreeNode.is(targetNode)) {\r\n                            model.selectNode(targetNode);\r\n                        }\r\n                        this.breadcrumbsFileTreeWidget.activate();\r\n                    }\r\n                });\r\n                return {\r\n                    dispose: () => {\r\n                        // Clear model otherwise the next time a popup is opened the old model is rendered first\r\n                        // and is shown for a short time period.\r\n                        toDisposeOnTreePopulated.dispose();\r\n                        this.breadcrumbsFileTreeWidget.model.root = undefined;\r\n                        Widget.detach(this.breadcrumbsFileTreeWidget);\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }\r\n\r\n    protected getContainerClassCreator(fileURI: URI): FilepathBreadcrumbClassNameFactory {\r\n        return (location, index) => location.isEqual(fileURI) ? 'file' : 'folder';\r\n    }\r\n\r\n    protected getIconClassCreator(fileURI: URI): FilepathBreadcrumbClassNameFactory {\r\n        return (location, index) => location.isEqual(fileURI) ? this.labelProvider.getIcon(location) + ' file-icon' : '';\r\n    }\r\n\r\n    protected filterBreadcrumbs(_: URI, breadcrumb: FilepathBreadcrumb): boolean {\r\n        return !breadcrumb.uri.path.isRoot;\r\n    }\r\n\r\n    protected async createRootNode(folderToOpen: FileStat): Promise<DirNode | undefined> {\r\n        const folderUri = folderToOpen.resource;\r\n        const rootUri = folderToOpen.isDirectory ? folderUri : folderUri.parent;\r\n        const rootStat = await this.fileSystem.resolve(rootUri);\r\n        if (rootStat) {\r\n            return DirNode.createRoot(rootStat);\r\n        }\r\n    }\r\n}\r\n"]}