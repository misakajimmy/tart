{"version":3,"sources":["common/uri-command-handler.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;kFAckF;AAKlF,OAAO,EAAC,YAAY,EAAC,MAAM,qBAAqB,CAAC;AAGjD,OAAO,GAAG,MAAM,OAAO,CAAC;AA0BxB,MAAM,OAAO,sBAAsB;IAKV;IACA;IACA;IANvB;;OAEG;IACH,YACuB,gBAAkC,EAClC,OAA6B,EAC7B,OAAwC;QAFxC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,YAAO,GAAP,OAAO,CAAsB;QAC7B,YAAO,GAAP,OAAO,CAAiC;IAE/D,CAAC;IAED,OAAO,CAAC,GAAG,IAAW;QACpB,MAAM,CAAC,GAAG,EAAE,GAAG,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,GAAG,IAAI,CAAC,CAAC;QACtD,OAAO,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;IAChE,CAAC;IAED,SAAS,CAAC,GAAG,IAAW;QACtB,MAAM,CAAC,GAAG,EAAE,GAAG,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,GAAG,IAAI,CAAC,CAAC;QACtD,IAAI,GAAG,EAAE;YACP,IAAI,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE;gBAC1B,OAAO,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,EAAE,GAAG,MAAM,CAAC,CAAC;aAC/C;YACD,OAAO,IAAI,CAAC;SACb;QACD,OAAO,KAAK,CAAC;IACf,CAAC;IAED,SAAS,CAAC,GAAG,IAAW;QACtB,MAAM,CAAC,GAAG,EAAE,GAAG,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,GAAG,IAAI,CAAC,CAAC;QACtD,IAAI,GAAG,EAAE;YACP,IAAI,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE;gBAC1B,OAAO,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,EAAE,GAAG,MAAM,CAAC,CAAC;aAC/C;YACD,OAAO,IAAI,CAAC;SACb;QACD,OAAO,KAAK,CAAC;IACf,CAAC;IAES,MAAM,CAAC,GAAG,IAAW;QAC7B,MAAM,CAAC,aAAa,CAAC,GAAG,IAAI,CAAC;QAC7B,MAAM,YAAY,GAAG,IAAI,CAAC,OAAO,EAAE;YAC/B,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC,IAAI,aAAa,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,YAAY,GAAG,CAAC;YAChF,CAAC,CAAC,aAAa,YAAY,GAAG,CAAC;QAEnC,IAAI,YAAY,EAAE;YAChB,OAAO,aAAa,CAAC;SACtB;QAED,MAAM,EAAC,SAAS,EAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC;QAE1C,MAAM,SAAS,GAAG,IAAI,CAAC,OAAO,EAAE;YAC5B,CAAC,CAAC,YAAY,CAAC,OAAO,CAAC,SAAS,CAAC;YACjC,CAAC,CAAC,YAAY,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;QAErC,OAAO,SAAc,CAAC;IACxB,CAAC;IAES,cAAc,CAAC,GAAG,IAAW;QACrC,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,CAAC;QACjC,MAAM,CAAC,QAAQ,EAAE,GAAG,MAAM,CAAC,GAAG,IAAI,CAAC;QACnC,IAAI,GAAG,KAAK,QAAQ,EAAE;YACpB,OAAO,CAAC,QAAQ,EAAE,GAAG,MAAM,CAAC,CAAC;SAC9B;QACD,OAAO,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;IACxB,CAAC;IAES,OAAO;QACf,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC;IAC9C,CAAC;CACF;AAED,WAAiB,sBAAsB;IAarC;;OAEG;IACH,SAAgB,UAAU,CAAC,gBAAkC,EAAE,OAA+B;QAC5F,qDAAqD,CAAC,sDAAsD;QAC5G,OAAO,IAAI,sBAAsB,CAAM,gBAAgB,EAAE,OAAO,EAAE,EAAC,KAAK,EAAE,KAAK,EAAC,CAAC,CAAC;IACpF,CAAC;IAHe,iCAAU,aAGzB,CAAA;IAED;;OAEG;IACH,SAAgB,WAAW,CAAC,gBAAkC,EAAE,OAAiC;QAC/F,qDAAqD,CAAC,sDAAsD;QAC5G,OAAO,IAAI,sBAAsB,CAAQ,gBAAgB,EAAE,OAAO,EAAE,EAAC,KAAK,EAAE,IAAI,EAAC,CAAC,CAAC;IACrF,CAAC;IAHe,kCAAW,cAG1B,CAAA;AACH,CAAC,EA5BgB,sBAAsB,KAAtB,sBAAsB,QA4BtC","file":"../../src/common/uri-command-handler.js","sourcesContent":["/********************************************************************************\n * Copyright (C) 2018 Ericsson and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport {SelectionService} from '../common/selection-service';\nimport {UriSelection} from '../common/selection';\nimport {CommandHandler} from './command';\nimport {MaybeArray} from '.';\nimport URI from './uri';\n\nexport interface UriCommandHandler<T extends MaybeArray<URI>> extends CommandHandler {\n\n  execute(uri: T, ...args: any[]): any;\n\n  isEnabled?(uri: T, ...args: any[]): boolean;\n\n  isVisible?(uri: T, ...args: any[]): boolean;\n\n}\n\n/**\n * Handler for a single URI-based selection.\n */\nexport interface SingleUriCommandHandler extends UriCommandHandler<URI> {\n\n}\n\n/**\n * Handler for multiple URIs.\n */\nexport interface MultiUriCommandHandler extends UriCommandHandler<URI[]> {\n\n}\n\nexport class UriAwareCommandHandler<T extends MaybeArray<URI>> implements UriCommandHandler<T> {\n  /**\n   * @deprecated since 1.6.0. Please use `UriAwareCommandHandler.MonoSelect` or `UriAwareCommandHandler.MultiSelect`.\n   */\n  constructor(\n      protected readonly selectionService: SelectionService,\n      protected readonly handler: UriCommandHandler<T>,\n      protected readonly options?: UriAwareCommandHandler.Options\n  ) {\n  }\n\n  execute(...args: any[]): object | undefined {\n    const [uri, ...others] = this.getArgsWithUri(...args);\n    return uri ? this.handler.execute(uri, ...others) : undefined;\n  }\n\n  isVisible(...args: any[]): boolean {\n    const [uri, ...others] = this.getArgsWithUri(...args);\n    if (uri) {\n      if (this.handler.isVisible) {\n        return this.handler.isVisible(uri, ...others);\n      }\n      return true;\n    }\n    return false;\n  }\n\n  isEnabled(...args: any[]): boolean {\n    const [uri, ...others] = this.getArgsWithUri(...args);\n    if (uri) {\n      if (this.handler.isEnabled) {\n        return this.handler.isEnabled(uri, ...others);\n      }\n      return true;\n    }\n    return false;\n  }\n\n  protected getUri(...args: any[]): T | undefined {\n    const [maybeUriArray] = args;\n    const firstArgIsOK = this.isMulti()\n        ? Array.isArray(maybeUriArray) && maybeUriArray.every(uri => uri instanceof URI)\n        : maybeUriArray instanceof URI;\n\n    if (firstArgIsOK) {\n      return maybeUriArray;\n    }\n\n    const {selection} = this.selectionService;\n\n    const uriOrUris = this.isMulti()\n        ? UriSelection.getUris(selection)\n        : UriSelection.getUri(selection);\n\n    return uriOrUris as T;\n  }\n\n  protected getArgsWithUri(...args: any[]): [T | undefined, ...any[]] {\n    const uri = this.getUri(...args);\n    const [maybeUri, ...others] = args;\n    if (uri === maybeUri) {\n      return [maybeUri, ...others];\n    }\n    return [uri, ...args];\n  }\n\n  protected isMulti(): boolean | undefined {\n    return this.options && !!this.options.multi;\n  }\n}\n\nexport namespace UriAwareCommandHandler {\n  /**\n   * Further options for the URI aware command handler instantiation.\n   */\n  export interface Options {\n\n    /**\n     * `true` if the handler supports multiple selection. Otherwise, `false`. Defaults to `false`.\n     */\n    readonly multi?: boolean,\n\n  }\n\n  /**\n   * @returns a command handler for mono-select contexts that expects a `URI` as the first parameter of its methods.\n   */\n  export function MonoSelect(selectionService: SelectionService, handler: UriCommandHandler<URI>): UriAwareCommandHandler<URI> {\n    /* eslint-disable-next-line deprecation/deprecation*/ // Safe to use when the generic and the options agree.\n    return new UriAwareCommandHandler<URI>(selectionService, handler, {multi: false});\n  }\n\n  /**\n   * @returns a command handler for multi-select contexts that expects a `URI[]` as the first parameter of its methods.\n   */\n  export function MultiSelect(selectionService: SelectionService, handler: UriCommandHandler<URI[]>): UriAwareCommandHandler<URI[]> {\n    /* eslint-disable-next-line deprecation/deprecation*/ // Safe to use when the generic and the options agree.\n    return new UriAwareCommandHandler<URI[]>(selectionService, handler, {multi: true});\n  }\n}\n\n"]}