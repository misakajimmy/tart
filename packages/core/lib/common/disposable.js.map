{"version":3,"sources":["common/disposable.ts"],"names":[],"mappings":"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","file":"../../src/common/disposable.js","sourcesContent":["/********************************************************************************\r\n * Copyright (C) 2017 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\nimport {Event} from './event';\r\nimport {Emitter} from './emitter';\r\n\r\nexport interface Disposable {\r\n  /**\r\n   * Dispose this object.\r\n   */\r\n  dispose(): void;\r\n}\r\n\r\nexport namespace Disposable {\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  export function is(arg: any): arg is Disposable {\r\n    return !!arg && typeof arg === 'object' && 'dispose' in arg && typeof arg['dispose'] === 'function';\r\n  }\r\n\r\n  export function create(func: () => void): Disposable {\r\n    return {\r\n      dispose: func\r\n    };\r\n  }\r\n\r\n  export const NULL = create(() => {\r\n  });\r\n}\r\n\r\nexport class DisposableCollection implements Disposable {\r\n\r\n  protected readonly disposables: Disposable[] = [];\r\n  protected readonly onDisposeEmitter = new Emitter<void>();\r\n  private disposingElements = false;\r\n\r\n  constructor(...toDispose: Disposable[]) {\r\n    toDispose.forEach(d => this.push(d));\r\n  }\r\n\r\n  /**\r\n   * This event is fired only once\r\n   * on first dispose of not empty collection.\r\n   */\r\n  get onDispose(): Event<void> {\r\n    return this.onDisposeEmitter.event;\r\n  }\r\n\r\n  get disposed(): boolean {\r\n    return this.disposables.length === 0;\r\n  }\r\n\r\n  dispose(): void {\r\n    if (this.disposed || this.disposingElements) {\r\n      return;\r\n    }\r\n    this.disposingElements = true;\r\n    while (!this.disposed) {\r\n      try {\r\n        this.disposables.pop()!.dispose();\r\n      } catch (e) {\r\n        console.error(e);\r\n      }\r\n    }\r\n    this.disposingElements = false;\r\n    this.checkDisposed();\r\n  }\r\n\r\n  push(disposable: Disposable): Disposable {\r\n    const disposables = this.disposables;\r\n    disposables.push(disposable);\r\n    const originalDispose = disposable.dispose.bind(disposable);\r\n    const toRemove = Disposable.create(() => {\r\n      const index = disposables.indexOf(disposable);\r\n      if (index !== -1) {\r\n        disposables.splice(index, 1);\r\n      }\r\n      this.checkDisposed();\r\n    });\r\n    disposable.dispose = () => {\r\n      toRemove.dispose();\r\n      disposable.dispose = originalDispose;\r\n      originalDispose();\r\n    };\r\n    return toRemove;\r\n  }\r\n\r\n  pushAll(disposables: Disposable[]): Disposable[] {\r\n    return disposables.map(disposable =>\r\n        this.push(disposable)\r\n    );\r\n  }\r\n\r\n  protected checkDisposed(): void {\r\n    if (this.disposed && !this.disposingElements) {\r\n      this.onDisposeEmitter.fire(undefined);\r\n      this.onDisposeEmitter.dispose();\r\n    }\r\n  }\r\n\r\n}\r\n"]}