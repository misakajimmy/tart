{"version":3,"sources":["common/application-error.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;kFAckF;AAWlF,MAAM,KAAW,gBAAgB,CA2DhC;AA3DD,WAAiB,gBAAgB;IAe/B,MAAM,KAAK,GAAa,EAAE,CAAC;IAE3B,SAAgB,OAAO,CAAsB,IAAO,EAAE,OAAuC;QAC3F,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE;YAC9B,MAAM,IAAI,KAAK,CAAC,6BAA6B,IAAI,4BAA4B,CAAC,CAAC;SAChF;QACD,MAAM,cAAc,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,IAAW,EAAE,EAAE,CAAC,IAAI,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,GAAG,IAAI,CAAC,EAAE,cAAc,CAAC,EAAE;YACzG,IAAI;YACJ,EAAE,CAAC,GAAuB;gBACxB,OAAO,GAAG,YAAY,IAAI,IAAI,GAAG,CAAC,IAAI,KAAK,IAAI,CAAC;YAClD,CAAC;SACF,CAAC,CAAC;QACH,OAAO,cAAc,CAAC;IACxB,CAAC;IAXe,wBAAO,UAWtB,CAAA;IAED,SAAgB,EAAE,CAAsB,GAAuB;QAC7D,OAAO,GAAG,YAAY,IAAI,CAAC;IAC7B,CAAC;IAFe,mBAAE,KAEjB,CAAA;IAED,SAAgB,QAAQ,CAAsB,IAAO,EAAE,GAAe;QACpE,OAAO,IAAI,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;IAC7B,CAAC;IAFe,yBAAQ,WAEvB,CAAA;IAED,MAAM,IAA0B,SAAQ,KAAK;QAI9B;QAHJ,IAAI,CAAI;QAEjB,YACa,IAAO,EAChB,GAAgC,EAChC,cAAyB;YAE3B,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;YAJR,SAAI,GAAJ,IAAI,CAAG;YAKlB,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;YACrB,MAAM,CAAC,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;YAC5C,IAAI,GAAG,CAAC,KAAK,EAAE;gBACb,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;aACxB;QACH,CAAC;QAED,MAAM;YACJ,MAAM,EAAC,OAAO,EAAE,IAAI,EAAE,KAAK,EAAC,GAAG,IAAI,CAAC;YACpC,OAAO,EAAC,OAAO,EAAE,IAAI,EAAE,KAAK,EAAC,CAAC;QAChC,CAAC;KACF;AACH,CAAC,EA3DgB,gBAAgB,KAAhB,gBAAgB,QA2DhC","file":"../../src/common/application-error.js","sourcesContent":["/********************************************************************************\n * Copyright (C) 2018 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nexport interface ApplicationError<C extends number, D> extends Error {\n  readonly code: C\n  readonly data: D\n\n  toJson(): ApplicationError.Literal<D>\n}\n\nexport namespace ApplicationError {\n  export interface Literal<D> {\n    message: string\n    data: D\n    stack?: string\n  }\n\n  export interface Constructor<C extends number, D> {\n    code: C;\n\n    (...args: any[]): ApplicationError<C, D>;\n\n    is(arg: object | undefined): arg is ApplicationError<C, D>\n  }\n\n  const codes: number[] = [];\n\n  export function declare<C extends number, D>(code: C, factory: (...args: any[]) => Literal<D>): Constructor<C, D> {\n    if (codes.indexOf(code) !== -1) {\n      throw new Error(`An application error for '${code}' code is already declared`);\n    }\n    const constructorOpt = Object.assign((...args: any[]) => new Impl(code, factory(...args), constructorOpt), {\n      code,\n      is(arg: object | undefined): arg is ApplicationError<C, D> {\n        return arg instanceof Impl && arg.code === code;\n      }\n    });\n    return constructorOpt;\n  }\n\n  export function is<C extends number, D>(arg: object | undefined): arg is ApplicationError<C, D> {\n    return arg instanceof Impl;\n  }\n\n  export function fromJson<C extends number, D>(code: C, raw: Literal<D>): ApplicationError<C, D> {\n    return new Impl(code, raw);\n  }\n\n  class Impl<C extends number, D> extends Error implements ApplicationError<C, D> {\n    readonly data: D;\n\n    constructor(\n        readonly code: C,\n        raw: ApplicationError.Literal<D>,\n        constructorOpt?: Function\n    ) {\n      super(raw.message);\n      this.data = raw.data;\n      Object.setPrototypeOf(this, Impl.prototype);\n      if (raw.stack) {\n        this.stack = raw.stack;\n      }\n    }\n\n    toJson(): ApplicationError.Literal<D> {\n      const {message, data, stack} = this;\n      return {message, data, stack};\n    }\n  }\n}\n"]}