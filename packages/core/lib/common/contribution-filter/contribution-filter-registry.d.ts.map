{"version":3,"sources":["common/contribution-filter/contribution-filter-registry.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;kFAckF;AAGlF,OAAO,EAAC,0BAA0B,EAAE,gBAAgB,EAAE,kBAAkB,EAAC,MAAM,uBAAuB,CAAC;AACvG,OAAO,EAAC,MAAM,EAAC,MAAM,UAAU,CAAC;AAEhC;;;;GAIG;AACH,qBACa,8BAA+B,YAAW,0BAA0B;IAE/E,SAAS,CAAC,WAAW,UAAS;IAC9B,SAAS,CAAC,cAAc,EAAE,MAAM,CAAC,MAAM,CAAC,EAAE,CAAM;IAChD,SAAS,CAAC,aAAa,0CAAiD;gBAGvB,aAAa,GAAE,kBAAkB,EAAO;IAQzF,UAAU,CAAC,KAAK,EAAE,GAAG,GAAG,gBAAgB,EAAE,EAAE,OAAO,EAAE,MAAM,CAAC,MAAM,CAAC,EAAE,GAAG,IAAI;IAY5E,YAAY,CAAC,CAAC,SAAS,MAAM,EAAE,QAAQ,EAAE,CAAC,EAAE,EAAE,IAAI,EAAE,gBAAgB,GAAG,CAAC,EAAE;IAU1E,SAAS,CAAC,WAAW,CAAC,IAAI,EAAE,gBAAgB,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE;IAQ/D,SAAS,CAAC,UAAU,CAAC,IAAI,EAAE,gBAAgB,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE;CAM/D","file":"../../../src/common/contribution-filter/contribution-filter-registry.d.ts","sourcesContent":["/********************************************************************************\r\n * Copyright (C) 2021 STMicroelectronics and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport {injectable, multiInject, optional} from 'inversify';\r\nimport {ContributionFilterRegistry, ContributionType, FilterContribution} from './contribution-filter';\r\nimport {Filter} from './filter';\r\n\r\n/**\r\n * Registry of contribution filters.\r\n *\r\n * Implement/bind to the `FilterContribution` interface/symbol to register your contribution filters.\r\n */\r\n@injectable()\r\nexport class ContributionFilterRegistryImpl implements ContributionFilterRegistry {\r\n\r\n  protected initialized = false;\r\n  protected genericFilters: Filter<Object>[] = [];\r\n  protected typeToFilters = new Map<ContributionType, Filter<Object>[]>();\r\n\r\n  constructor(\r\n      @multiInject(FilterContribution) @optional() contributions: FilterContribution[] = []\r\n  ) {\r\n    for (const contribution of contributions) {\r\n      contribution.registerContributionFilters(this);\r\n    }\r\n    this.initialized = true;\r\n  }\r\n\r\n  addFilters(types: '*' | ContributionType[], filters: Filter<Object>[]): void {\r\n    if (this.initialized) {\r\n      throw new Error('cannot add filters after initialization is done.');\r\n    } else if (types === '*') {\r\n      this.genericFilters.push(...filters);\r\n    } else {\r\n      for (const type of types) {\r\n        this.getOrCreate(type).push(...filters);\r\n      }\r\n    }\r\n  }\r\n\r\n  applyFilters<T extends Object>(toFilter: T[], type: ContributionType): T[] {\r\n    const filters = this.getFilters(type);\r\n    if (filters.length === 0) {\r\n      return toFilter;\r\n    }\r\n    return toFilter.filter(\r\n        object => filters.every(filter => filter(object))\r\n    );\r\n  }\r\n\r\n  protected getOrCreate(type: ContributionType): Filter<Object>[] {\r\n    let value = this.typeToFilters.get(type);\r\n    if (value === undefined) {\r\n      this.typeToFilters.set(type, value = []);\r\n    }\r\n    return value;\r\n  }\r\n\r\n  protected getFilters(type: ContributionType): Filter<Object>[] {\r\n    return [\r\n      ...this.typeToFilters.get(type) || [],\r\n      ...this.genericFilters\r\n    ];\r\n  }\r\n}\r\n\r\n"]}