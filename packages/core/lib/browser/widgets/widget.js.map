{"version":3,"sources":["browser/widgets/widget.ts"],"names":[],"mappings":"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","file":"../../../src/browser/widgets/widget.js","sourcesContent":["/********************************************************************************\n * Copyright (C) 2017 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport {decorate, injectable, unmanaged} from 'inversify';\nimport {Widget} from '@lumino/widgets';\nimport {Message, MessageLoop} from '@lumino/messaging';\nimport {Disposable, DisposableCollection, Emitter, Event, MaybePromise} from '../../common';\nimport {KeyCode, KeysOrKeyCodes} from '../keyboard';\n\nimport PerfectScrollbar from 'perfect-scrollbar';\n\ndecorate(injectable(), Widget);\ndecorate(unmanaged(), Widget, 0);\n\nexport * from '@lumino/widgets';\nexport * from '@lumino/messaging';\n\nexport const ACTION_ITEM = 'action-item';\n\nexport function codiconArray(name: string, actionItem = false): string[] {\n  const array = ['codicon', `codicon-${name}`];\n  if (actionItem) {\n    array.push(ACTION_ITEM);\n  }\n  return array;\n}\n\nexport function codicon(name: string, actionItem = false): string {\n  return `codicon codicon-${name}${actionItem ? ` ${ACTION_ITEM}` : ''}`;\n}\n\nexport const DISABLED_CLASS = 'tart-mod-disabled';\nexport const EXPANSION_TOGGLE_CLASS = 'tart-ExpansionToggle';\nexport const CODICON_TREE_ITEM_CLASSES = codiconArray('chevron-down');\nexport const COLLAPSED_CLASS = 'tart-mod-collapsed';\nexport const BUSY_CLASS = 'tart-mod-busy';\nexport const CODICON_LOADING_CLASSES = codiconArray('loading');\nexport const SELECTED_CLASS = 'tart-mod-selected';\nexport const FOCUS_CLASS = 'tart-mod-focus';\nexport const DEFAULT_SCROLL_OPTIONS: PerfectScrollbar.Options = {\n  suppressScrollX: true,\n  minScrollbarLength: 35,\n};\n\n/**\n * At a number of places in the code, we have effectively reimplemented Phosphor's Widget.attach and Widget.detach,\n * but omitted the checks that Phosphor expects to be performed for those operations. That is a bad idea, because it\n * means that we are telling widgets that they are attached or detached when not all the conditions that should apply\n * do apply. We should explicitly mark those locations so that we know where we should go fix them later.\n */\nexport namespace UnsafeWidgetUtilities {\n  /**\n   * Ordinarily, the following checks should be performed before detaching a widget:\n   * It should not be the child of another widget\n   * It should be attached and it should be a child of document.body\n   */\n  export function detach(widget: Widget): void {\n    MessageLoop.sendMessage(widget, Widget.Msg.BeforeDetach);\n    widget.node.remove();\n    MessageLoop.sendMessage(widget, Widget.Msg.AfterDetach);\n  }\n\n  /**\n   * @param ref The child of the host element to insert the widget before.\n   * Ordinarily the following checks should be performed:\n   * The widget should have no parent\n   * The widget should not be attached, and its node should not be a child of document.body\n   * The host should be a child of document.body\n   * We often violate the last condition.\n   */\n  // eslint-disable-next-line no-null/no-null\n  export function attach(widget: Widget, host: HTMLElement, ref: HTMLElement | null = null): void {\n    MessageLoop.sendMessage(widget, Widget.Msg.BeforeAttach);\n    host.insertBefore(widget.node, ref);\n    MessageLoop.sendMessage(widget, Widget.Msg.AfterAttach);\n  }\n}\n\n@injectable()\nexport class BaseWidget extends Widget {\n\n  readonly onScrollYReachEndEmitter = new Emitter<void>();\n  onScrollYReachEnd: Event<void> = this.onScrollYReachEndEmitter.event;\n  protected readonly onScrollUpEmitter = new Emitter<void>();\n  readonly onScrollUp: Event<void> = this.onScrollUpEmitter.event;\n  protected readonly onDidChangeVisibilityEmitter = new Emitter<boolean>();\n  readonly onDidChangeVisibility = this.onDidChangeVisibilityEmitter.event;\n  protected readonly onDidDisposeEmitter = new Emitter<void>();\n  readonly onDidDispose = this.onDidDisposeEmitter.event;\n\n  protected readonly toDispose = new DisposableCollection(\n      this.onDidDisposeEmitter,\n      Disposable.create(() => this.onDidDisposeEmitter.fire()),\n      this.onScrollYReachEndEmitter,\n      this.onScrollUpEmitter,\n      this.onDidChangeVisibilityEmitter\n  );\n  protected readonly toDisposeOnDetach = new DisposableCollection();\n  protected scrollBar?: PerfectScrollbar;\n  protected scrollOptions?: PerfectScrollbar.Options;\n\n  dispose(): void {\n    if (this.isDisposed) {\n      return;\n    }\n    super.dispose();\n    this.toDispose.dispose();\n  }\n\n  setFlag(flag: Widget.Flag): void {\n    super.setFlag(flag);\n    if (flag === Widget.Flag.IsVisible) {\n      this.onDidChangeVisibilityEmitter.fire(this.isVisible);\n    }\n  }\n\n  clearFlag(flag: Widget.Flag): void {\n    super.clearFlag(flag);\n    if (flag === Widget.Flag.IsVisible) {\n      this.onDidChangeVisibilityEmitter.fire(this.isVisible);\n    }\n  }\n\n  protected onCloseRequest(msg: Message): void {\n    super.onCloseRequest(msg);\n    this.dispose();\n  }\n\n  protected onBeforeAttach(msg: Message): void {\n    if (this.title.iconClass === '') {\n      this.title.iconClass = 'no-icon';\n    }\n    super.onBeforeAttach(msg);\n  }\n\n  protected onAfterDetach(msg: Message): void {\n    if (this.title.iconClass === 'no-icon') {\n      this.title.iconClass = '';\n    }\n    super.onAfterDetach(msg);\n  }\n\n  protected onBeforeDetach(msg: Message): void {\n    this.toDisposeOnDetach.dispose();\n    super.onBeforeDetach(msg);\n  }\n\n  protected onAfterAttach(msg: Message): void {\n    super.onAfterAttach(msg);\n    if (this.scrollOptions) {\n      (async () => {\n        const container = await this.getScrollContainer();\n        container.style.overflow = 'hidden';\n        this.scrollBar = new PerfectScrollbar(container, this.scrollOptions);\n        this.disableScrollBarFocus(container);\n        this.toDisposeOnDetach.push(addEventListener(container, <any>'ps-y-reach-end', () => {\n          this.onScrollYReachEndEmitter.fire(undefined);\n        }));\n        this.toDisposeOnDetach.push(addEventListener(container, <any>'ps-scroll-up', () => {\n          this.onScrollUpEmitter.fire(undefined);\n        }));\n        this.toDisposeOnDetach.push(Disposable.create(() => {\n          if (this.scrollBar) {\n            this.scrollBar.destroy();\n            this.scrollBar = undefined;\n          }\n          container.style.overflow = 'initial';\n        }));\n      })();\n    }\n  }\n\n  protected getScrollContainer(): MaybePromise<HTMLElement> {\n    return this.node;\n  }\n\n  protected disableScrollBarFocus(scrollContainer: HTMLElement): void {\n    for (const thumbs of [scrollContainer.getElementsByClassName('ps__thumb-x'), scrollContainer.getElementsByClassName('ps__thumb-y')]) {\n      for (let i = 0; i < thumbs.length; i++) {\n        const element = thumbs.item(i);\n        if (element) {\n          element.removeAttribute('tabIndex');\n        }\n      }\n    }\n  }\n\n  protected onUpdateRequest(msg: Message): void {\n    super.onUpdateRequest(msg);\n    if (this.scrollBar) {\n      this.scrollBar.update();\n    }\n  }\n\n  protected addUpdateListener<K extends keyof HTMLElementEventMap>(element: HTMLElement, type: K, useCapture?: boolean): void {\n    this.addEventListener(element, type, e => {\n      this.update();\n      e.preventDefault();\n    }, useCapture);\n  }\n\n  protected addEventListener<K extends keyof HTMLElementEventMap>(element: HTMLElement, type: K, listener: EventListenerOrEventListenerObject<K>, useCapture?: boolean): void {\n    this.toDisposeOnDetach.push(addEventListener(element, type, listener, useCapture));\n  }\n\n  protected addKeyListener<K extends keyof HTMLElementEventMap>(\n      element: HTMLElement,\n      keysOrKeyCodes: KeyCode.Predicate | KeysOrKeyCodes,\n      action: (event: KeyboardEvent) => boolean | void | Object, ...additionalEventTypes: K[]): void {\n    this.toDisposeOnDetach.push(addKeyListener(element, keysOrKeyCodes, action, ...additionalEventTypes));\n  }\n\n  protected addClipboardListener<K extends 'cut' | 'copy' | 'paste'>(element: HTMLElement, type: K, listener: EventListenerOrEventListenerObject<K>): void {\n    this.toDisposeOnDetach.push(addClipboardListener(element, type, listener));\n  }\n}\n\nexport function setEnabled(element: HTMLElement, enabled: boolean): void {\n  element.classList.toggle(DISABLED_CLASS, !enabled);\n  element.tabIndex = enabled ? 0 : -1;\n}\n\nexport function createIconButton(...classNames: string[]): HTMLSpanElement {\n  const icon = document.createElement('i');\n  icon.classList.add(...classNames);\n  const button = document.createElement('span');\n  button.tabIndex = 0;\n  button.appendChild(icon);\n  return button;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type EventListener<K extends keyof HTMLElementEventMap> = (this: HTMLElement, event: HTMLElementEventMap[K]) => any;\n\nexport interface EventListenerObject<K extends keyof HTMLElementEventMap> {\n  handleEvent(evt: HTMLElementEventMap[K]): void;\n}\n\nexport namespace EventListenerObject {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  export function is<K extends keyof HTMLElementEventMap>(listener: any | undefined): listener is EventListenerObject<K> {\n    return !!listener && 'handleEvent' in listener;\n  }\n}\nexport type EventListenerOrEventListenerObject<K extends keyof HTMLElementEventMap> =\n    EventListener<K>\n    | EventListenerObject<K>;\n\nexport function addEventListener<K extends keyof HTMLElementEventMap>(\n    element: HTMLElement, type: K, listener: EventListenerOrEventListenerObject<K>, useCapture?: boolean\n): Disposable {\n  element.addEventListener(type, listener, useCapture);\n  return Disposable.create(() =>\n      element.removeEventListener(type, listener, useCapture)\n  );\n}\n\nexport function addKeyListener<K extends keyof HTMLElementEventMap>(\n    element: HTMLElement,\n    keysOrKeyCodes: KeyCode.Predicate | KeysOrKeyCodes,\n    action: (event: KeyboardEvent) => boolean | void | Object, ...additionalEventTypes: K[]): Disposable {\n\n  const toDispose = new DisposableCollection();\n  const keyCodePredicate = (() => {\n    if (typeof keysOrKeyCodes === 'function') {\n      return keysOrKeyCodes;\n    } else {\n      return (actual: KeyCode) => KeysOrKeyCodes.toKeyCodes(keysOrKeyCodes).some(k => k.equals(actual));\n    }\n  })();\n  toDispose.push(addEventListener(element, 'keydown', e => {\n    const kc = KeyCode.createKeyCode(e);\n    if (keyCodePredicate(kc)) {\n      const result = action(e);\n      if (typeof result !== 'boolean' || result) {\n        e.stopPropagation();\n        e.preventDefault();\n      }\n    }\n  }));\n  for (const type of additionalEventTypes) {\n    toDispose.push(addEventListener(element, type, e => {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const event = (type as any)['keydown'];\n      const result = action(event);\n      if (typeof result !== 'boolean' || result) {\n        e.stopPropagation();\n        e.preventDefault();\n      }\n    }));\n  }\n  return toDispose;\n}\n\nexport function addClipboardListener<K extends 'cut' | 'copy' | 'paste'>(element: HTMLElement, type: K, listener: EventListenerOrEventListenerObject<K>): Disposable {\n  const documentListener = (e: ClipboardEvent) => {\n    const activeElement = document.activeElement;\n    if (activeElement && element.contains(activeElement)) {\n      if (EventListenerObject.is(listener)) {\n        listener.handleEvent(e);\n      } else {\n        listener.bind(element)(e);\n      }\n    }\n  };\n  document.addEventListener(type, documentListener);\n  return Disposable.create(() =>\n      document.removeEventListener(type, documentListener)\n  );\n}\n\n/**\n * Resolves when the given widget is detached and hidden.\n */\nexport function waitForClosed(widget: Widget): Promise<void> {\n  return waitForVisible(widget, false, false);\n}\n\n/**\n * Resolves when the given widget is attached and visible.\n */\nexport function waitForRevealed(widget: Widget): Promise<void> {\n  return waitForVisible(widget, true, true);\n}\n\n/**\n * Resolves when the given widget is hidden regardless of attachment.\n */\nexport function waitForHidden(widget: Widget): Promise<void> {\n  return waitForVisible(widget, true);\n}\n\nfunction waitForVisible(widget: Widget, visible: boolean, attached?: boolean): Promise<void> {\n  if ((typeof attached !== 'boolean' || widget.isAttached === attached) &&\n      (widget.isVisible === visible || (widget.node.style.visibility !== 'hidden') === visible)\n  ) {\n    return new Promise(resolve => window.requestAnimationFrame(() => resolve()));\n  }\n  return new Promise(resolve => {\n    const waitFor = () => window.requestAnimationFrame(() => {\n      if ((typeof attached !== 'boolean' || widget.isAttached === attached) &&\n          (widget.isVisible === visible || (widget.node.style.visibility !== 'hidden') === visible)) {\n        window.requestAnimationFrame(() => resolve());\n      } else {\n        waitFor();\n      }\n    });\n    waitFor();\n  });\n}\n"]}