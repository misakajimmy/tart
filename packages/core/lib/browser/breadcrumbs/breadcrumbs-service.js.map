{"version":3,"sources":["browser/breadcrumbs/breadcrumbs-service.ts"],"names":[],"mappings":"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","file":"../../../src/browser/breadcrumbs/breadcrumbs-service.js","sourcesContent":["/********************************************************************************\n * Copyright (C) 2019 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\nimport {inject, injectable, named, postConstruct} from 'inversify';\nimport {ContributionProvider, Emitter, Event, Prioritizeable} from '../../common';\nimport URI from '../../common/uri';\nimport {Coordinate} from '../context-menu-renderer';\nimport {BreadcrumbPopupContainer, BreadcrumbPopupContainerFactory} from './breadcrumb-popup-container';\nimport {Breadcrumb, BreadcrumbsContribution, Styles} from './breadcrumbs-constants';\n\n@injectable()\nexport class BreadcrumbsService {\n\n  @inject(ContributionProvider) @named(BreadcrumbsContribution)\n  protected readonly contributions: ContributionProvider<BreadcrumbsContribution>;\n\n  @inject(BreadcrumbPopupContainerFactory) protected readonly breadcrumbPopupContainerFactory: BreadcrumbPopupContainerFactory;\n\n  protected hasSubscribed = false;\n\n  protected popupsOverlayContainer: HTMLDivElement;\n\n  protected readonly onDidChangeBreadcrumbsEmitter = new Emitter<URI>();\n\n  /**\n   * Subscribe to this event emitter to be notified when the breadcrumbs have changed.\n   * The URI is the URI of the editor the breadcrumbs have changed for.\n   */\n  get onDidChangeBreadcrumbs(): Event<URI> {\n    // This lazy subscription is to address problems in inversify's instantiation routine\n    // related to use of the IconThemeService by different components instantiated by the\n    // ContributionProvider.\n    if (!this.hasSubscribed) {\n      this.subscribeToContributions();\n    }\n    return this.onDidChangeBreadcrumbsEmitter.event;\n  }\n\n  @postConstruct()\n  init(): void {\n    this.createOverlayContainer();\n  }\n\n  /**\n   * Returns the breadcrumbs for a given URI, possibly an empty list.\n   */\n  async getBreadcrumbs(uri: URI): Promise<Breadcrumb[]> {\n    const result: Breadcrumb[] = [];\n    for (const contribution of await this.prioritizedContributions()) {\n      result.push(...await contribution.computeBreadcrumbs(uri));\n    }\n    return result;\n  }\n\n  /**\n   * Opens a popup for the given breadcrumb at the given position.\n   */\n  async openPopup(breadcrumb: Breadcrumb, position: Coordinate): Promise<BreadcrumbPopupContainer | undefined> {\n    const contribution = this.contributions.getContributions().find(c => c.type === breadcrumb.type);\n    if (contribution) {\n      const popup = this.breadcrumbPopupContainerFactory(this.popupsOverlayContainer, breadcrumb.id, position);\n      const popupContent = await contribution.attachPopupContent(breadcrumb, popup.container);\n      if (popupContent && popup.isOpen) {\n        popup.onDidDispose(() => popupContent.dispose());\n      } else {\n        popupContent?.dispose();\n      }\n      return popup;\n    }\n  }\n\n  protected createOverlayContainer(): void {\n    this.popupsOverlayContainer = window.document.createElement('div');\n    this.popupsOverlayContainer.id = Styles.BREADCRUMB_POPUP_OVERLAY_CONTAINER;\n    if (window.document.body) {\n      window.document.body.appendChild(this.popupsOverlayContainer);\n    }\n  }\n\n  /**\n   * Subscribes to the onDidChangeBreadcrumbs events for all contributions.\n   */\n  protected subscribeToContributions(): void {\n    this.hasSubscribed = true;\n    for (const contribution of this.contributions.getContributions()) {\n      contribution.onDidChangeBreadcrumbs(uri => this.onDidChangeBreadcrumbsEmitter.fire(uri));\n    }\n  }\n\n  protected async prioritizedContributions(): Promise<BreadcrumbsContribution[]> {\n    const prioritized = await Prioritizeable.prioritizeAll(\n        this.contributions.getContributions(), contribution => contribution.priority);\n    return prioritized.map(p => p.value).reverse();\n  }\n}\n"]}