{"version":3,"sources":["browser/breadcrumbs/breadcrumbs-renderer.tsx"],"names":[],"mappings":"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","file":"../../../src/browser/breadcrumbs/breadcrumbs-renderer.js","sourcesContent":["/********************************************************************************\n * Copyright (C) 2019 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\nimport * as React from 'react';\nimport {inject, injectable, postConstruct} from 'inversify';\nimport {ReactRenderer} from '../widgets';\nimport {BreadcrumbsService} from './breadcrumbs-service';\nimport {BreadcrumbRenderer} from './breadcrumb-renderer';\nimport PerfectScrollbar from 'perfect-scrollbar';\nimport URI from '../../common/uri';\nimport {Emitter, Event} from '../../common';\nimport {BreadcrumbPopupContainer} from './breadcrumb-popup-container';\nimport {DisposableCollection} from '../../common/disposable';\nimport {CorePreferences} from '../core-preferences';\nimport {Breadcrumb, Styles} from './breadcrumbs-constants';\nimport {LabelProvider} from '../label-provider';\n\ninterface Cancelable {\n  canceled: boolean;\n}\n\n@injectable()\nexport class BreadcrumbsRenderer extends ReactRenderer {\n\n  @inject(BreadcrumbsService)\n  protected readonly breadcrumbsService: BreadcrumbsService;\n\n  @inject(BreadcrumbRenderer)\n  protected readonly breadcrumbRenderer: BreadcrumbRenderer;\n\n  @inject(CorePreferences)\n  protected readonly corePreferences: CorePreferences;\n\n  @inject(LabelProvider)\n  protected readonly labelProvider: LabelProvider;\n\n  protected readonly onDidChangeActiveStateEmitter = new Emitter<boolean>();\n  protected uri: URI | undefined;\n  protected breadcrumbs: Breadcrumb[] = [];\n  protected popup: BreadcrumbPopupContainer | undefined;\n  protected scrollbar: PerfectScrollbar | undefined;\n  protected toDispose: DisposableCollection = new DisposableCollection();\n  protected refreshCancellationMarker: Cancelable = {canceled: true};\n\n  get onDidChangeActiveState(): Event<boolean> {\n    return this.onDidChangeActiveStateEmitter.event;\n  }\n\n  get active(): boolean {\n    return !!this.breadcrumbs.length;\n  }\n\n  protected get breadCrumbsContainer(): Element | undefined {\n    return this.host.firstElementChild ?? undefined;\n  }\n\n  dispose(): void {\n    super.dispose();\n    this.toDispose.dispose();\n    if (this.popup) {\n      this.popup.dispose();\n    }\n    if (this.scrollbar) {\n      this.scrollbar.destroy();\n      this.scrollbar = undefined;\n    }\n  }\n\n  async refresh(uri?: URI): Promise<void> {\n    this.uri = uri;\n    this.refreshCancellationMarker.canceled = true;\n    const currentCallCanceled = {canceled: false};\n    this.refreshCancellationMarker = currentCallCanceled;\n    let breadcrumbs: Breadcrumb[];\n    if (uri && this.corePreferences['breadcrumbs.enabled']) {\n      breadcrumbs = await this.breadcrumbsService.getBreadcrumbs(uri);\n    } else {\n      breadcrumbs = [];\n    }\n    if (currentCallCanceled.canceled) {\n      return;\n    }\n\n    const wasActive = this.active;\n    this.breadcrumbs = breadcrumbs;\n    const isActive = this.active;\n    if (wasActive !== isActive) {\n      this.onDidChangeActiveStateEmitter.fire(isActive);\n    }\n\n    this.update();\n  }\n\n  @postConstruct()\n  protected init(): void {\n    this.toDispose.push(this.onDidChangeActiveStateEmitter);\n    this.toDispose.push(this.breadcrumbsService.onDidChangeBreadcrumbs(uri => {\n      if (this.uri?.isEqual(uri)) {\n        this.refresh(this.uri);\n      }\n    }));\n    this.toDispose.push(this.corePreferences.onPreferenceChanged(change => {\n      if (change.preferenceName === 'breadcrumbs.enabled') {\n        this.refresh(this.uri);\n      }\n    }));\n    this.toDispose.push(this.labelProvider.onDidChange(() => this.refresh(this.uri)));\n  }\n\n  protected update(): void {\n    this.render();\n\n    if (!this.scrollbar) {\n      this.createScrollbar();\n    } else {\n      this.scrollbar.update();\n    }\n    this.scrollToEnd();\n  }\n\n  protected createScrollbar(): void {\n    const {breadCrumbsContainer} = this;\n    if (breadCrumbsContainer) {\n      this.scrollbar = new PerfectScrollbar(breadCrumbsContainer, {\n        handlers: ['drag-thumb', 'keyboard', 'wheel', 'touch'],\n        useBothWheelAxes: true,\n        scrollXMarginOffset: 4,\n        suppressScrollY: true\n      });\n    }\n  }\n\n  protected scrollToEnd(): void {\n    const {breadCrumbsContainer} = this;\n    if (breadCrumbsContainer) {\n      breadCrumbsContainer.scrollLeft = breadCrumbsContainer.scrollWidth;\n    }\n  }\n\n  protected doRender(): React.ReactNode {\n    return <ul className={Styles.BREADCRUMBS}>{this.renderBreadcrumbs()}</ul>;\n  }\n\n  protected renderBreadcrumbs(): React.ReactNode {\n    return this.breadcrumbs.map(breadcrumb => this.breadcrumbRenderer.render(breadcrumb, this.togglePopup));\n  }\n\n  protected togglePopup = (breadcrumb: Breadcrumb, event: React.MouseEvent) => {\n    event.stopPropagation();\n    event.preventDefault();\n    let openPopup = true;\n    if (this.popup?.isOpen) {\n      this.popup.dispose();\n\n      // There is a popup open. If the popup is the popup that belongs to the currently clicked breadcrumb\n      // just close the popup. If another breadcrumb was clicked, open the new popup immediately.\n      openPopup = this.popup.breadcrumbId !== breadcrumb.id;\n    } else {\n      this.popup = undefined;\n    }\n    if (openPopup) {\n      const {currentTarget} = event;\n      const breadcrumbElement = currentTarget.closest(`.${Styles.BREADCRUMB_ITEM}`);\n      if (breadcrumbElement) {\n        const {left: x, bottom: y} = breadcrumbElement.getBoundingClientRect();\n        this.breadcrumbsService.openPopup(breadcrumb, {x, y}).then(popup => {\n          this.popup = popup;\n        });\n      }\n    }\n  };\n}\n\nexport const BreadcrumbsRendererFactory = Symbol('BreadcrumbsRendererFactory');\n\nexport interface BreadcrumbsRendererFactory {\n  (): BreadcrumbsRenderer;\n}\n"]}