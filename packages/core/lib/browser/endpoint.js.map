{"version":3,"sources":["browser/endpoint.ts"],"names":[],"mappings":"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","file":"../../src/browser/endpoint.js","sourcesContent":["/********************************************************************************\n * Copyright (C) 2017 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\nimport URI from '../common/uri';\n\n/**\n * An endpoint provides URLs for http and ws, based on configuration and defaults.\n */\nexport class Endpoint {\n  static readonly PROTO_HTTPS: string = 'https:';\n  static readonly PROTO_HTTP: string = 'http:';\n  static readonly PROTO_WS: string = 'ws:';\n  static readonly PROTO_WSS: string = 'wss:';\n  static readonly PROTO_FILE: string = 'file:';\n\n  constructor(\n      protected readonly options: Endpoint.Options = {},\n      protected readonly location: Endpoint.Location = self.location\n  ) {\n  }\n\n  get host(): string {\n    if (this.options.host) {\n      return this.options.host;\n    }\n    if (this.location.host) {\n      return this.location.host;\n    }\n    return 'localhost:' + this.port;\n  }\n\n  /**\n   * The HTTP/HTTPS scheme of the endpoint, or the user defined one.\n   * See: `Endpoint.Options.httpScheme`.\n   */\n  get httpScheme(): string {\n    if (this.options.httpScheme) {\n      return this.options.httpScheme;\n    }\n    if (this.location.protocol === Endpoint.PROTO_HTTP ||\n        this.location.protocol === Endpoint.PROTO_HTTPS) {\n      return this.location.protocol;\n    }\n    return Endpoint.PROTO_HTTP;\n  }\n\n  protected get pathname(): string {\n    if (this.location.protocol === Endpoint.PROTO_FILE) {\n      return '';\n    }\n    if (this.location.pathname === '/') {\n      return '';\n    }\n    if (this.location.pathname.endsWith('/')) {\n      return this.location.pathname.substr(0, this.location.pathname.length - 1);\n    }\n    return this.location.pathname;\n  }\n\n  protected get port(): string {\n    return this.getSearchParam('port', '3000');\n  }\n\n  protected get wsScheme(): string {\n    if (this.options.wsScheme) {\n      return this.options.wsScheme;\n    }\n    return this.httpScheme === Endpoint.PROTO_HTTPS ? Endpoint.PROTO_WSS : Endpoint.PROTO_WS;\n  }\n\n  protected get path(): string {\n    if (this.options.path) {\n      if (this.options.path.startsWith('/')) {\n        return this.options.path;\n      } else {\n        return '/' + this.options.path;\n      }\n    }\n    return this.options.path || '';\n  }\n\n  getWebSocketUrl(): URI {\n    return new URI(`${this.wsScheme}//${this.host}${this.pathname}${this.path}`);\n  }\n\n  getRestUrl(): URI {\n    return new URI(`${this.httpScheme}//${this.host}${this.pathname}${this.path}`);\n  }\n\n  protected getSearchParam(name: string, defaultValue: string): string {\n    const search = this.location.search;\n    if (!search) {\n      return defaultValue;\n    }\n    return search.substr(1).split('&')\n        .filter(value => value.startsWith(name + '='))\n        .map(value => {\n          const encoded = value.substr(name.length + 1);\n          return decodeURIComponent(encoded);\n        })[0] || defaultValue;\n  }\n}\n\nexport namespace Endpoint {\n  export class Options {\n    host?: string;\n    wsScheme?: string;\n    httpScheme?: string;\n    path?: string;\n  }\n\n  // Necessary for running tests with dependency on TS lib on node\n  // FIXME figure out how to mock with ts-node\n  export class Location {\n    host: string;\n    pathname: string;\n    search: string;\n    protocol: string;\n  }\n}\n"]}