{"version":3,"sources":["browser/context-menu-renderer.ts"],"names":[],"mappings":"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","file":"../../src/browser/context-menu-renderer.js","sourcesContent":["/********************************************************************************\n * Copyright (C) 2017 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport {injectable} from 'inversify';\nimport {MenuPath} from '../common/menu';\nimport {Disposable, DisposableCollection} from '../common';\n\nexport interface Coordinate {\n  x: number;\n  y: number;\n}\n\nexport const Coordinate = Symbol('Coordinate');\n\nexport type Anchor = MouseEvent | Coordinate;\n\nexport function toAnchor(anchor: HTMLElement | Coordinate): Anchor {\n  return anchor instanceof HTMLElement ? {x: anchor.offsetLeft, y: anchor.offsetTop} : anchor;\n}\n\nexport function coordinateFromAnchor(anchor: Anchor): Coordinate {\n  const {x, y} = anchor instanceof MouseEvent ? {x: anchor.clientX, y: anchor.clientY} : anchor;\n  return {x, y};\n}\n\nexport abstract class ContextMenuAccess implements Disposable {\n\n  protected readonly toDispose = new DisposableCollection();\n  readonly onDispose = this.toDispose.onDispose;\n\n  constructor(toClose: Disposable) {\n    this.toDispose.push(toClose);\n  }\n\n  get disposed(): boolean {\n    return this.toDispose.disposed;\n  }\n\n  dispose(): void {\n    this.toDispose.dispose();\n  }\n\n}\n\n@injectable()\nexport abstract class ContextMenuRenderer {\n\n  protected readonly toDisposeOnSetCurrent = new DisposableCollection();\n\n  protected _current: ContextMenuAccess | undefined;\n\n  /**\n   * Currently opened context menu.\n   * Rendering a new context menu will close the current.\n   */\n  get current(): ContextMenuAccess | undefined {\n    return this._current;\n  }\n\n  render(options: RenderContextMenuOptions): ContextMenuAccess;\n\n  /** @deprecated since 0.7.2 pass `RenderContextMenuOptions` instead */\n  render(menuPath: MenuPath, anchor: Anchor, onHide?: () => void): ContextMenuAccess;\n\n  render(menuPathOrOptions: MenuPath | RenderContextMenuOptions, anchor?: Anchor, onHide?: () => void): ContextMenuAccess {\n    const resolvedOptions = RenderContextMenuOptions.resolve(menuPathOrOptions, anchor, onHide);\n    const access = this.doRender(resolvedOptions);\n    this.setCurrent(access);\n    return access;\n  }\n\n  protected setCurrent(current: ContextMenuAccess | undefined): void {\n    if (this._current === current) {\n      return;\n    }\n    this.toDisposeOnSetCurrent.dispose();\n    this._current = current;\n    if (current) {\n      this.toDisposeOnSetCurrent.push(current.onDispose(() => {\n        this._current = undefined;\n      }));\n      this.toDisposeOnSetCurrent.push(current);\n    }\n  }\n\n  protected abstract doRender(options: RenderContextMenuOptions): ContextMenuAccess;\n\n}\n\nexport interface RenderContextMenuOptions {\n  menuPath: MenuPath\n  anchor: Anchor\n  args?: any[]\n  onHide?: () => void\n}\n\nexport namespace RenderContextMenuOptions {\n  export function resolve(menuPathOrOptions: MenuPath | RenderContextMenuOptions, anchor?: Anchor, onHide?: () => void): RenderContextMenuOptions {\n    let menuPath: MenuPath;\n    let args: any[];\n    if (Array.isArray(menuPathOrOptions)) {\n      menuPath = menuPathOrOptions;\n      args = [anchor!];\n    } else {\n      menuPath = menuPathOrOptions.menuPath;\n      anchor = menuPathOrOptions.anchor;\n      onHide = menuPathOrOptions.onHide;\n      args = menuPathOrOptions.args ? [...menuPathOrOptions.args, anchor] : [anchor];\n    }\n    return {\n      menuPath,\n      anchor: anchor!,\n      onHide,\n      args\n    };\n  }\n}\n"]}