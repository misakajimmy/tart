{"version":3,"sources":["browser/color-application-contribution.ts"],"names":[],"mappings":"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","file":"../../src/browser/color-application-contribution.js","sourcesContent":["import {inject, injectable, named} from 'inversify';\nimport {FrontendApplicationContribution} from './frontend-application';\nimport {ContributionProvider, Disposable, DisposableCollection, Emitter} from '../common';\nimport {ColorRegistry} from './color-registry';\nimport {ThemeService} from './theming';\n\nexport const ColorContribution = Symbol('ColorContribution');\n\nexport interface ColorContribution {\n  registerColors(colors: ColorRegistry): void;\n}\n\n@injectable()\nexport class ColorApplicationContribution implements FrontendApplicationContribution {\n\n  private static themeBackgroundId = 'theme.background';\n  protected readonly onDidChangeEmitter = new Emitter<void>();\n  readonly onDidChange = this.onDidChangeEmitter.event;\n  @inject(ColorRegistry)\n  protected readonly colors: ColorRegistry;\n  @inject(ContributionProvider) @named(ColorContribution)\n  protected readonly colorContributions: ContributionProvider<ColorContribution>;\n  protected readonly toUpdate = new DisposableCollection();\n\n  static initBackground(): void {\n    const value = window.localStorage.getItem(this.themeBackgroundId) || '#1d1d1d';\n    const documentElement = document.documentElement;\n    documentElement.style.setProperty('--tart-editor-background', value);\n  }\n\n  onStart(): void {\n    for (const contribution of this.colorContributions.getContributions()) {\n      contribution.registerColors(this.colors);\n    }\n\n    this.updateThemeBackground();\n    ThemeService.get().onDidColorThemeChange(() => this.updateThemeBackground());\n    this.update();\n    ThemeService.get().onDidColorThemeChange(() => this.update());\n    this.colors.onDidChange(() => this.update());\n  }\n\n  protected update(): void {\n    if (!document) {\n      return;\n    }\n    this.toUpdate.dispose();\n    const theme = 'tart-' + ThemeService.get().getCurrentTheme().type;\n    document.body.classList.add(theme);\n    this.toUpdate.push(Disposable.create(() => document.body.classList.remove(theme)));\n\n    const documentElement = document.documentElement;\n    if (documentElement) {\n      for (const id of this.colors.getColors()) {\n        const variable = this.colors.getCurrentCssVariable(id);\n        if (variable) {\n          const {name, value} = variable;\n          documentElement.style.setProperty(name, value);\n          this.toUpdate.push(Disposable.create(() => documentElement.style.removeProperty(name)));\n        }\n      }\n    }\n    this.onDidChangeEmitter.fire(undefined);\n  }\n\n  protected updateThemeBackground(): void {\n    const color = this.colors.getCurrentColor('editor.background');\n    if (color) {\n      window.localStorage.setItem(ColorApplicationContribution.themeBackgroundId, color);\n    } else {\n      window.localStorage.removeItem(ColorApplicationContribution.themeBackgroundId);\n    }\n  }\n}\n"]}