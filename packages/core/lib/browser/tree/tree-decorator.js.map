{"version":3,"sources":["browser/tree/tree-decorator.ts"],"names":[],"mappings":"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","file":"../../../src/browser/tree/tree-decorator.js","sourcesContent":["/********************************************************************************\n * Copyright (C) 2018 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\nimport {injectable} from 'inversify';\nimport {Tree, TreeNode} from './tree';\nimport {Disposable, DisposableCollection, Emitter, Event, MaybePromise} from '../../common';\nimport {WidgetDecoration} from '../widget-decoration';\n\n/**\n * The {@link TreeDecorator} allows adapting the look and the style of the tree items within a widget. Changes are reflected in\n * the form of `decoration data`. This `decoration data` is a map storing {@link TreeDecoration.Data} for affected tree nodes (using the unique node id as key).\n * It is important to notice that there is no common contribution point for `TreeDecorators`. Instead, each {@link TreeDecoratorService} is\n * supposed to declare its own contribution provider for `TreeDecorators`.\n *\n * ### Example usage\n * A simple tree decorator that changes the background color of each tree node to `red`.\n *\n * ```typescript\n * @injectable()\n * export class MyTreeDecorator implements TreeDecorator {\n *     id = 'myTreeDecorator';\n *\n *     protected readonly emitter = new Emitter<(tree: Tree) => Map<string, TreeDecoration.Data>>();\n *\n *     get onDidChangeDecorations(): Event<(tree: Tree) => Map<string, TreeDecoration.Data>> {\n *         return this.emitter.event;\n *     }\n *\n *     decorations(tree: Tree): MaybePromise<Map<string, TreeDecoration.Data>> {\n *         const result = new Map();\n *\n *         if (tree.root === undefined) {\n *             return result;\n *         }\n *         for (const treeNode of new DepthFirstTreeIterator(tree.root)) {\n *             result.set(treeNode.id,<TreeDecoration.Data>{backgroundColor:'red'})\n *         }\n *         return result;\n *     }\n * }\n * ```\n */\nexport interface TreeDecorator {\n\n  /**\n   * The unique identifier of the decorator. Ought to be unique in the application.\n   */\n  readonly id: string;\n\n  /**\n   * Fired when this decorator has calculated all the `decoration data` for the tree nodes.\n   */\n  readonly onDidChangeDecorations: Event<(tree: Tree) => Map<string, TreeDecoration.Data>>;\n\n  /**\n   * Computes the current `decoration data` for the given tree. Might return a promise if the computation is handled asynchronously.\n   *\n   * @param tree the tree to decorate.\n   *\n   * @returns (a promise of) a map containing the current {@linkTreeDecoration.Data} for each node. Keys are the unique identifier of the tree nodes.\n   */\n  decorations(tree: Tree): MaybePromise<Map<string, TreeDecoration.Data>>;\n\n}\n\nexport const TreeDecoratorService = Symbol('TreeDecoratorService');\n\n/**\n * The {@link TreeDecoratorService} manages a set of known {link TreeDecorator}s and emits events when\n * any of the known decorators has changes. Typically, a `TreeDecoratorService` provides a contribution point that can be used to\n * register {@link TreeDecorator}s exclusively for this service.\n *\n * ### Example usage\n * ```typescript\n * export const MyTreeDecorator = Symbol('MyTreeDecorator');\n *\n * @injectable()\n * export class MyDecorationService extends AbstractTreeDecoratorService {\n *     constructor(@inject(ContributionProvider) @named(MyTreeDecorator) protected readonly contributions: ContributionProvider<TreeDecorator>) {\n *         super(contributions.getContributions());\n *     }\n * }\n * ```\n */\nexport interface TreeDecoratorService extends Disposable {\n\n  /**\n   * Fired when any of the available tree decorators has changes.\n   */\n  readonly onDidChangeDecorations: Event<void>;\n\n  /**\n   * Computes the decorations for the tree based on the actual state of this decorator service.\n   *\n   * @param tree the tree to decorate\n   *\n   * @returns (a promise of) the computed `decoration data`\n   */\n  getDecorations(tree: Tree): MaybePromise<Map<string, TreeDecoration.Data[]>>;\n\n  /**\n   * Transforms the `decoration data` into an object, so that it can be safely serialized into JSON.\n   * @param decorations the `decoration data` that should be deflated\n   *\n   * @returns the `decoration data` as serializable JSON object\n   */\n  deflateDecorators(decorations: Map<string, TreeDecoration.Data[]>): object;\n\n  /**\n   * Counterpart of the [deflateDecorators](#deflateDecorators) method. Restores the argument into a Map\n   * of tree node IDs and the corresponding decorations data array (`decoration data`).\n   *\n   * @returns the deserialized `decoration data\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  inflateDecorators(state: any): Map<string, TreeDecoration.Data[]>;\n\n}\n\n/**\n * The default tree decorator service. Does nothing at all. One has to rebind to a concrete implementation\n * if decorators have to be supported in the tree widget.\n */\n@injectable()\nexport class NoopTreeDecoratorService implements TreeDecoratorService {\n\n  protected readonly emitter = new Emitter<void>();\n  readonly onDidChangeDecorations = this.emitter.event;\n\n  dispose(): void {\n    this.emitter.dispose();\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  getDecorations(): Map<any, any> {\n    return new Map();\n  }\n\n  deflateDecorators(): object {\n    return {};\n  }\n\n  inflateDecorators(): Map<string, TreeDecoration.Data[]> {\n    return new Map();\n  }\n\n}\n\n/**\n * Abstract decorator service implementation which emits events from all known tree decorators and caches the current state.\n */\n@injectable()\nexport abstract class AbstractTreeDecoratorService implements TreeDecoratorService {\n\n  protected readonly onDidChangeDecorationsEmitter = new Emitter<void>();\n  readonly onDidChangeDecorations = this.onDidChangeDecorationsEmitter.event;\n\n  protected readonly toDispose = new DisposableCollection();\n\n  constructor(protected readonly decorators: ReadonlyArray<TreeDecorator>) {\n    this.toDispose.push(this.onDidChangeDecorationsEmitter);\n    this.toDispose.pushAll(this.decorators.map(decorator =>\n        decorator.onDidChangeDecorations(data =>\n            this.onDidChangeDecorationsEmitter.fire(undefined)\n        ))\n    );\n  }\n\n  dispose(): void {\n    this.toDispose.dispose();\n  }\n\n  async getDecorations(tree: Tree): Promise<Map<string, TreeDecoration.Data[]>> {\n    const changes = new Map();\n    for (const decorator of this.decorators) {\n      for (const [id, data] of (await decorator.decorations(tree)).entries()) {\n        if (changes.has(id)) {\n          changes.get(id)!.push(data);\n        } else {\n          changes.set(id, [data]);\n        }\n      }\n    }\n    return changes;\n  }\n\n  deflateDecorators(decorations: Map<string, TreeDecoration.Data[]>): object {\n    // eslint-disable-next-line no-null/no-null\n    const state = Object.create(null);\n    for (const [id, data] of decorations) {\n      state[id] = data;\n    }\n    return state;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  inflateDecorators(state: any): Map<string, TreeDecoration.Data[]> {\n    const decorators = new Map<string, TreeDecoration.Data[]>();\n    for (const id of Object.keys(state)) {\n      decorators.set(id, state[id]);\n    }\n    return decorators;\n  }\n\n}\n\n/**\n * @deprecated import from `@tart/core/lib/browser/widget-decoration` instead.\n */\nexport import TreeDecoration = WidgetDecoration;\n\nexport interface DecoratedTreeNode extends TreeNode {\n  /**\n   * The additional tree decoration data attached to the tree node itself.\n   */\n  readonly decorationData: TreeDecoration.Data;\n}\n\nexport namespace DecoratedTreeNode {\n  /**\n   * Type-guard for decorated tree nodes.\n   */\n  export function is(node: TreeNode | undefined): node is DecoratedTreeNode {\n    return !!node && 'decorationData' in node;\n  }\n}\n"]}