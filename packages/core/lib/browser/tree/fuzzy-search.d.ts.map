{"version":3,"sources":["browser/tree/fuzzy-search.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;kFAckF;AAElF,OAAO,KAAK,KAAK,MAAM,OAAO,CAAC;AAG/B,qBACa,WAAW;IAEtB,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAU;IACrC,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAU;IAEtC;;OAEG;IACG,MAAM,CAAC,CAAC,EAAE,KAAK,EAAE,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;IAQ7E,SAAS,CAAC,WAAW,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,GAAG,MAAM;IAI3F,SAAS,CAAC,SAAS,CAAC,CAAC,EAAE,MAAM,EAAE,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,GAAG,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC;IAO3E,SAAS,CAAC,SAAS,CAAC,KAAK,EAAE,MAAM,GAAG,aAAa,CAAC,WAAW,CAAC,KAAK,CAAC;CA2BrE;AAED;;GAEG;AACH,yBAAiB,WAAW,CAAC;IAE3B;;OAEG;IACH,UAAiB,KAAK;QAEpB;;WAEG;QACH,QAAQ,CAAC,MAAM,EAAE,MAAM,CAAC;QAExB;;WAEG;QACH,QAAQ,CAAC,MAAM,EAAE,MAAM,CAAC;KACzB;IAED;;OAEG;IACH,UAAiB,KAAK,CAAC,CAAC;QAEtB;;WAEG;QACH,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC;QAEjB;;WAEG;QACH,QAAQ,CAAC,MAAM,EAAE,aAAa,CAAC,KAAK,CAAC,CAAC;KACvC;IAED;;OAEG;IACH,UAAiB,KAAK,CAAC,CAAC;QAEtB;;WAEG;QACH,QAAQ,CAAC,OAAO,EAAE,MAAM,CAAC;QAEzB;;WAEG;QACH,QAAQ,CAAC,KAAK,EAAE,aAAa,CAAC,CAAC,CAAC,CAAC;QAEjC;;WAEG;QACH,QAAQ,CAAC,SAAS,EAAE,CAAC,IAAI,EAAE,CAAC,KAAK,MAAM,CAAC;KAEzC;CAEF","file":"../../../src/browser/tree/fuzzy-search.d.ts","sourcesContent":["/********************************************************************************\n * Copyright (C) 2018 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\nimport * as fuzzy from 'fuzzy';\nimport {injectable} from 'inversify';\n\n@injectable()\nexport class FuzzySearch {\n\n  private static readonly PRE = '\\x01';\n  private static readonly POST = '\\x02';\n\n  /**\n   * Filters the input and returns with an array that contains all items that match the pattern.\n   */\n  async filter<T>(input: FuzzySearch.Input<T>): Promise<FuzzySearch.Match<T>[]> {\n    return fuzzy.filter(input.pattern, input.items.slice(), {\n      pre: FuzzySearch.PRE,\n      post: FuzzySearch.POST,\n      extract: input.transform\n    }).sort(this.sortResults.bind(this)).map(this.mapResult.bind(this));\n  }\n\n  protected sortResults<T>(left: fuzzy.FilterResult<T>, right: fuzzy.FilterResult<T>): number {\n    return left.index - right.index;\n  }\n\n  protected mapResult<T>(result: fuzzy.FilterResult<T>): FuzzySearch.Match<T> {\n    return {\n      item: result.original,\n      ranges: this.mapRanges(result.string)\n    };\n  }\n\n  protected mapRanges(input: string): ReadonlyArray<FuzzySearch.Range> {\n    const copy = input.split('').filter(s => s !== '');\n    const ranges: FuzzySearch.Range[] = [];\n    const validate = (pre: number, post: number) => {\n      if (preIndex > postIndex || (preIndex === -1) !== (postIndex === -1)) {\n        throw new Error(`Error when trying to map ranges. Escaped string was: '${input}. [${[...input].join('|')}]'`);\n      }\n    };\n    let preIndex = copy.indexOf(FuzzySearch.PRE);\n    let postIndex = copy.indexOf(FuzzySearch.POST);\n    validate(preIndex, postIndex);\n    while (preIndex !== -1 && postIndex !== -1) {\n      ranges.push({\n        offset: preIndex,\n        length: postIndex - preIndex - 1\n      });\n      copy.splice(postIndex, 1);\n      copy.splice(preIndex, 1);\n      preIndex = copy.indexOf(FuzzySearch.PRE);\n      postIndex = copy.indexOf(FuzzySearch.POST);\n    }\n    if (ranges.length === 0) {\n      throw new Error(`Unexpected zero ranges for match-string: ${input}.`);\n    }\n    return ranges;\n  }\n\n}\n\n/**\n * Fuzzy searcher.\n */\nexport namespace FuzzySearch {\n\n  /**\n   * A range representing the match region.\n   */\n  export interface Range {\n\n    /**\n     * The zero based offset of the match region.\n     */\n    readonly offset: number;\n\n    /**\n     * The length of the match region.\n     */\n    readonly length: number;\n  }\n\n  /**\n   * A fuzzy search match.\n   */\n  export interface Match<T> {\n\n    /**\n     * The original item.\n     */\n    readonly item: T;\n\n    /**\n     * An array of ranges representing the match regions.\n     */\n    readonly ranges: ReadonlyArray<Range>;\n  }\n\n  /**\n   * The fuzzy search input.\n   */\n  export interface Input<T> {\n\n    /**\n     * The pattern to match.\n     */\n    readonly pattern: string;\n\n    /**\n     * The items to filter based on the `pattern`.\n     */\n    readonly items: ReadonlyArray<T>;\n\n    /**\n     * Function that extracts the string from the inputs which will be used to evaluate the fuzzy matching filter.\n     */\n    readonly transform: (item: T) => string;\n\n  }\n\n}\n"]}