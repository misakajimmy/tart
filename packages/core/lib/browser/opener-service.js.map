{"version":3,"sources":["browser/opener-service.ts"],"names":[],"mappings":"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","file":"../../src/browser/opener-service.js","sourcesContent":["/********************************************************************************\n * Copyright (C) 2017 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\nimport {inject, injectable, named} from 'inversify';\nimport URI from '../common/uri';\nimport {ContributionProvider, Disposable, Emitter, Event, MaybePromise, Prioritizeable} from '../common';\n\nexport interface OpenerOptions {\n}\n\nexport const OpenHandler = Symbol('OpenHandler');\n\n/**\n * `OpenHandler` should be implemented to provide a new opener.\n */\nexport interface OpenHandler {\n  /**\n   * A unique id of this handler.\n   */\n  readonly id: string;\n  /**\n   * A human-readable name of this handler.\n   */\n  readonly label?: string;\n  /**\n   * A css icon class of this handler.\n   */\n  readonly iconClass?: string;\n\n  /**\n   * Test whether this handler can open the given URI for given options.\n   * Return a nonzero number if this handler can open; otherwise it cannot.\n   * Never reject.\n   *\n   * A returned value indicating a priority of this handler.\n   */\n  canHandle(uri: URI, options?: OpenerOptions): MaybePromise<number>;\n\n  /**\n   * Open a widget for the given URI and options.\n   * Resolve to an opened widget or undefined, e.g. if a page is opened.\n   * Never reject if `canHandle` return a positive number; otherwise should reject.\n   */\n  open(uri: URI, options?: OpenerOptions): MaybePromise<object | undefined>;\n}\n\nexport const OpenerService = Symbol('OpenerService');\n\n/**\n * `OpenerService` provide an access to existing openers.\n */\nexport interface OpenerService {\n  /**\n   * Event that fires when a new opener is added or removed.\n   */\n  onDidChangeOpeners?: Event<void>;\n\n  /**\n   * Return all registered openers.\n   * Never reject.\n   */\n  getOpeners(): Promise<OpenHandler[]>;\n\n  /**\n   * Return all openers able to open the given URI for given options\n   * ordered according their priority.\n   * Never reject.\n   */\n  getOpeners(uri: URI, options?: OpenerOptions): Promise<OpenHandler[]>;\n\n  /**\n   * Return an opener with the higher priority for the given URI.\n   * Reject if such does not exist.\n   */\n  getOpener(uri: URI, options?: OpenerOptions): Promise<OpenHandler>;\n\n  /**\n   * Add open handler i.e. for custom editors\n   */\n  addHandler?(openHandler: OpenHandler): Disposable;\n}\n\nexport async function open(openerService: OpenerService, uri: URI, options?: OpenerOptions): Promise<object | undefined> {\n  const opener = await openerService.getOpener(uri, options);\n  return opener.open(uri, options);\n}\n\n@injectable()\nexport class DefaultOpenerService implements OpenerService {\n  // Collection of open-handlers for custom-editor contributions.\n  protected readonly customEditorOpenHandlers: OpenHandler[] = [];\n\n  protected readonly onDidChangeOpenersEmitter = new Emitter<void>();\n  readonly onDidChangeOpeners = this.onDidChangeOpenersEmitter.event;\n\n  constructor(\n      @inject(ContributionProvider) @named(OpenHandler)\n      protected readonly handlersProvider: ContributionProvider<OpenHandler>\n  ) {\n  }\n\n  addHandler(openHandler: OpenHandler): Disposable {\n    this.customEditorOpenHandlers.push(openHandler);\n    this.onDidChangeOpenersEmitter.fire();\n\n    return Disposable.create(() => {\n      this.customEditorOpenHandlers.splice(this.customEditorOpenHandlers.indexOf(openHandler), 1);\n      this.onDidChangeOpenersEmitter.fire();\n    });\n  }\n\n  async getOpener(uri: URI, options?: OpenerOptions): Promise<OpenHandler> {\n    const handlers = await this.prioritize(uri, options);\n    if (handlers.length >= 1) {\n      return handlers[0];\n    }\n    return Promise.reject(new Error(`There is no opener for ${uri}.`));\n  }\n\n  async getOpeners(uri?: URI, options?: OpenerOptions): Promise<OpenHandler[]> {\n    return uri ? this.prioritize(uri, options) : this.getHandlers();\n  }\n\n  protected async prioritize(uri: URI, options?: OpenerOptions): Promise<OpenHandler[]> {\n    const prioritized = await Prioritizeable.prioritizeAll(this.getHandlers(), async handler => {\n      try {\n        return await handler.canHandle(uri, options);\n      } catch {\n        return 0;\n      }\n    });\n    return prioritized.map(p => p.value);\n  }\n\n  protected getHandlers(): OpenHandler[] {\n    return [\n      ...this.handlersProvider.getContributions(),\n      ...this.customEditorOpenHandlers\n    ];\n  }\n\n}\n"]}