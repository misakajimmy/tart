{"version":3,"sources":["browser/diff-uris.ts"],"names":[],"mappings":"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","file":"../../src/browser/diff-uris.js","sourcesContent":["/********************************************************************************\n * Copyright (C) 2017 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\nimport {inject, injectable} from 'inversify';\nimport URI from '../common/uri';\nimport {DidChangeLabelEvent, LabelProvider, LabelProviderContribution} from './label-provider';\nimport {codicon} from './widgets';\n\nexport namespace DiffUris {\n\n  export const DIFF_SCHEME = 'diff';\n\n  export function encode(left: URI, right: URI, label?: string): URI {\n    const diffUris = [\n      left.toString(),\n      right.toString()\n    ];\n\n    const diffUriStr = JSON.stringify(diffUris);\n\n    return new URI().withScheme(DIFF_SCHEME).withPath(label || '').withQuery(diffUriStr);\n  }\n\n  export function decode(uri: URI): URI[] {\n    if (uri.scheme !== DIFF_SCHEME) {\n      throw new Error((`The URI must have scheme \"diff\". The URI was: ${uri}.`));\n    }\n    const diffUris: string[] = JSON.parse(uri.query);\n    return diffUris.map(s => new URI(s));\n  }\n\n  export function isDiffUri(uri: URI): boolean {\n    return uri.scheme === DIFF_SCHEME;\n  }\n\n}\n\n@injectable()\nexport class DiffUriLabelProviderContribution implements LabelProviderContribution {\n\n  constructor(@inject(LabelProvider) protected labelProvider: LabelProvider) {\n  }\n\n  canHandle(element: object): number {\n    if (element instanceof URI && DiffUris.isDiffUri(element)) {\n      return 20;\n    }\n    return 0;\n  }\n\n  getLongName(uri: URI): string {\n    const label = uri.path.toString();\n    if (label) {\n      return label;\n    }\n    const [left, right] = DiffUris.decode(uri);\n    const leftLongName = this.labelProvider.getLongName(left);\n    const rightLongName = this.labelProvider.getLongName(right);\n    if (leftLongName === rightLongName) {\n      return leftLongName;\n    }\n    return `${leftLongName} ⟷ ${rightLongName}`;\n  }\n\n  getName(uri: URI): string {\n    const label = uri.path.toString();\n    if (label) {\n      return label;\n    }\n    const [left, right] = DiffUris.decode(uri);\n\n    if (left.path.toString() === right.path.toString() && left.query && right.query) {\n      const prefix = left.displayName ? `${left.displayName}: ` : '';\n      return `${prefix}${left.query} ⟷ ${right.query}`;\n    } else {\n      let title;\n      if (uri.displayName && left.path.toString() !== right.path.toString() && left.displayName !== uri.displayName) {\n        title = `${uri.displayName}: `;\n      } else {\n        title = '';\n      }\n\n      const leftLongName = this.labelProvider.getName(left);\n      const rightLongName = this.labelProvider.getName(right);\n      if (leftLongName === rightLongName) {\n        return leftLongName;\n      }\n      return `${title}${leftLongName} ⟷ ${rightLongName}`;\n    }\n  }\n\n  getIcon(uri: URI): string {\n    return codicon('split-horizontal');\n  }\n\n  affects(diffUri: URI, event: DidChangeLabelEvent): boolean {\n    for (const uri of DiffUris.decode(diffUri)) {\n      if (event.affects(uri)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n}\n"]}