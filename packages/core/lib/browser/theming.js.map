{"version":3,"sources":["browser/theming.ts"],"names":[],"mappings":"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","file":"../../src/browser/theming.js","sourcesContent":["/********************************************************************************\r\n * Copyright (C) 2017 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport {Emitter, Event} from '../common';\r\nimport {Disposable} from '../common/disposable';\r\nimport {Theme, ThemeChangeEvent} from '../common/theme';\r\nimport darkCss from '../assets/style/variables-dark.useable.css';\r\nimport lightCss from '../assets/style/variables-bright.useable.css';\r\n\r\n/**\r\n * @deprecated since 1.20.0. Import from `@tart/core/lib/common/theme` instead.\r\n */\r\nexport * from '../common/theme';\r\n\r\nexport const ThemeServiceSymbol = Symbol('ThemeService');\r\n\r\nexport class ThemeService {\r\n\r\n  protected themes: { [id: string]: Theme } = {};\r\n  protected activeTheme: Theme | undefined;\r\n  protected readonly themeChange = new Emitter<ThemeChangeEvent>();\r\n\r\n  readonly onDidColorThemeChange: Event<ThemeChangeEvent> = this.themeChange.event;\r\n\r\n  /**\r\n   * The default theme. If that is not applicable, returns with the fallback theme.\r\n   */\r\n  get defaultTheme(): Theme {\r\n    return this.themes['dark'] || this.themes['dark'];\r\n  }\r\n\r\n  get getAllThemes(): { [id: string]: Theme } {\r\n    return this.themes;\r\n  }\r\n\r\n  static get(): ThemeService {\r\n    const global = window as any;\r\n    if (!global[ThemeServiceSymbol]) {\r\n      const themeService = new ThemeService();\r\n      themeService.register(...BuiltinThemeProvider.themes);\r\n      themeService.startupTheme();\r\n      global[ThemeServiceSymbol] = themeService;\r\n    }\r\n    return global[ThemeServiceSymbol];\r\n  }\r\n\r\n  register(...themes: Theme[]): Disposable {\r\n    for (const theme of themes) {\r\n      this.themes[theme.id] = theme;\r\n    }\r\n    this.validateActiveTheme();\r\n    return Disposable.create(() => {\r\n      for (const theme of themes) {\r\n        delete this.themes[theme.id];\r\n      }\r\n      this.validateActiveTheme();\r\n    });\r\n  }\r\n\r\n  getThemes(): Theme[] {\r\n    const result = [];\r\n    for (const o in this.themes) {\r\n      if (this.themes.hasOwnProperty(o)) {\r\n        result.push(this.themes[o]);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  getTheme(themeId: string): Theme {\r\n    return this.themes[themeId];\r\n  }\r\n\r\n  startupTheme(): void {\r\n    const theme = this.getCurrentTheme();\r\n    // console.log(theme);\r\n    theme.activate();\r\n  }\r\n\r\n  loadUserTheme(): void {\r\n    const theme = this.getCurrentTheme();\r\n    this.setCurrentTheme(theme.id);\r\n  }\r\n\r\n  setCurrentTheme(themeId: string): void {\r\n    const newTheme = this.getTheme(themeId);\r\n    const oldTheme = this.activeTheme;\r\n    if (oldTheme) {\r\n      if (oldTheme.id === newTheme.id) {\r\n        return;\r\n      }\r\n      oldTheme.deactivate();\r\n    }\r\n    newTheme.activate();\r\n    this.activeTheme = newTheme;\r\n    window.localStorage.setItem('theme', themeId);\r\n    this.themeChange.fire({\r\n      newTheme, oldTheme\r\n    });\r\n  }\r\n\r\n  getCurrentTheme(): Theme {\r\n    const themeId = window.localStorage.getItem('theme') || this.defaultTheme.id;\r\n    return this.getTheme(themeId);\r\n  }\r\n\r\n  /**\r\n   * Resets the state to the user's default, or to the fallback theme. Also discards any persisted state in the local storage.\r\n   */\r\n  reset(): void {\r\n    // this.setCurrentTheme(this.defaultTheme.id);\r\n  }\r\n\r\n  protected validateActiveTheme(): void {\r\n    if (!this.activeTheme) {\r\n      return;\r\n    }\r\n    const theme = this.themes[this.activeTheme.id];\r\n    if (!theme) {\r\n      this.loadUserTheme();\r\n    } else if (theme !== this.activeTheme) {\r\n      this.activeTheme = undefined;\r\n      this.setCurrentTheme(theme.id);\r\n    }\r\n  }\r\n}\r\n\r\nexport class BuiltinThemeProvider {\r\n\r\n  static readonly darkCss = darkCss;\r\n  static readonly lightCss = lightCss;\r\n\r\n  // Webpack converts these `require` in some Javascript object that wraps the `.css` files\r\n\r\n  static readonly darkTheme: Theme = {\r\n    id: 'dark',\r\n    type: 'dark',\r\n    label: 'Dark (Tart)',\r\n    editorTheme: 'dark-tart', // loaded in /packages/monaco/src/browser/textmate/monaco-theme-registry.ts\r\n    activate(): void {\r\n      BuiltinThemeProvider.darkCss.use();\r\n    },\r\n    deactivate(): void {\r\n      BuiltinThemeProvider.darkCss.unuse();\r\n    }\r\n  };\r\n\r\n  static readonly lightTheme: Theme = {\r\n    id: 'light',\r\n    type: 'light',\r\n    label: 'Light (Tart)',\r\n    editorTheme: 'light-tart', // loaded in /packages/monaco/src/browser/textmate/monaco-theme-registry.ts\r\n    activate(): void {\r\n      BuiltinThemeProvider.lightCss.use();\r\n    },\r\n    deactivate(): void {\r\n      BuiltinThemeProvider.lightCss.unuse();\r\n    }\r\n  };\r\n\r\n  static readonly hcTheme: Theme = {\r\n    id: 'hc-tart',\r\n    type: 'hc',\r\n    label: 'High Contrast (Tart)',\r\n    editorTheme: 'hc-tart', // loaded in /packages/monaco/src/browser/textmate/monaco-theme-registry.ts\r\n    activate(): void {\r\n      BuiltinThemeProvider.darkCss.use();\r\n    },\r\n    deactivate(): void {\r\n      BuiltinThemeProvider.darkCss.unuse();\r\n    }\r\n  };\r\n\r\n  static readonly themes = [\r\n    this.darkTheme,\r\n    this.lightTheme,\r\n    this.hcTheme\r\n  ];\r\n}\r\n"]}