{"version":3,"sources":["browser/shell/view-contribution.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;kFAckF;;;;;;;AAElF,OAAO,EAAC,MAAM,EAAE,UAAU,EAAc,QAAQ,EAAC,MAAM,WAAW,CAAC;AAEnE,OAAO,EAAU,mBAAmB,EAAmB,gBAAgB,EAAoB,MAAM,cAAc,CAAC;AAChH,OAAO,EAAC,sBAAsB,EAAqB,MAAM,eAAe,CAAC;AACzE,OAAO,EAAC,aAAa,EAAC,MAAM,mBAAmB,CAAC;AAChD,OAAO,EAAC,WAAW,EAAC,MAAM,iCAAiC,CAAC;AAC5D,OAAO,EAAC,gBAAgB,EAAC,MAAM,qBAAqB,CAAC;AACrD,OAAO,EAAC,gBAAgB,EAAC,MAAM,gBAAgB,CAAC;AAiBhD,8DAA8D;AAC9D,MAAM,UAAU,oBAAoB,CAA0C,IAAqB,EAAE,UAAiC;IACpI,MAAM,MAAM,GAAG,IAAI,CAAI,UAAU,CAAC,CAAC,MAAM,EAAE,CAAC,gBAAgB,EAAE,CAAC;IAC/D,IAAI,CAAC,mBAAmB,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;IAChD,IAAI,CAAC,sBAAsB,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;IACnD,IAAI,CAAC,gBAAgB,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;IAC7C,OAAO,MAAM,CAAC;AAChB,CAAC;AAED;;GAEG;AAEH,IAAsB,wBAAwB,GAA9C,MAAsB,wBAAwB;IASrB;IAPd,aAAa,CAAW;IACS,aAAa,CAAgB;IAC1B,KAAK,CAAmB;IAElD,SAAS,CAAmB;IAE/C,YACuB,OAAgC;QAAhC,YAAO,GAAP,OAAO,CAAyB;QAErD,IAAI,OAAO,CAAC,eAAe,EAAE;YAC3B,IAAI,CAAC,aAAa,GAAG;gBACnB,EAAE,EAAE,OAAO,CAAC,eAAe;gBAC3B,KAAK,EAAE,SAAS,GAAG,IAAI,CAAC,SAAS,GAAG,OAAO;aAC5C,CAAC;SACH;IACH,CAAC;IAED,IAAI,MAAM;QACR,OAAO,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC;IAC/B,CAAC;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC;IACjC,CAAC;IAED,IAAI,kBAAkB;QACpB,OAAO,IAAI,CAAC,OAAO,CAAC,oBAAoB,CAAC;IAC3C,CAAC;IAED,IAAI,MAAM;QACR,OAAO,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAC3D,CAAC;IAED,YAAY;QACV,OAAO,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IACtD,CAAC;IAED,KAAK,CAAC,QAAQ,CAAC,OAAmC,EAAE;QAClD,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;QACzB,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,IAAI,CAAC,OAAO,CAAC,eAAe,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC;QACvG,MAAM,MAAM,GAAG,KAAK,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QAC1C,MAAM,IAAI,GAAG,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACtC,IAAI,CAAC,MAAM,EAAE;YACX,yDAAyD;YACzD,MAAM,UAAU,GAAsB;gBACpC,GAAG,IAAI,CAAC,kBAAkB;gBAC1B,GAAG,IAAI;aACR,CAAC;YACF,MAAM,KAAK,CAAC,SAAS,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;SAC3C;aAAM,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,IAAI,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC,YAAY,KAAK,MAAM,CAAC,KAAK,EAAE;YAChG,gFAAgF;YAChF,QAAQ,IAAI,EAAE;gBACZ,KAAK,MAAM,CAAC;gBACZ,KAAK,OAAO;oBACV,MAAM,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;oBAChC,MAAM;gBACR,KAAK,QAAQ;oBACX,0DAA0D;oBAC1D,IAAI,KAAK,CAAC,iBAAiB,CAAC,MAAM,KAAK,CAAC,EAAE;wBACxC,MAAM,KAAK,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;qBACrC;oBACD,MAAM;gBACR;oBACE,yDAAyD;oBACzD,MAAM,IAAI,CAAC,SAAS,EAAE,CAAC;aAC1B;YACD,OAAO,IAAI,CAAC,MAAM,CAAC;SACpB;QACD,IAAI,MAAM,CAAC,UAAU,IAAI,IAAI,CAAC,QAAQ,EAAE;YACtC,MAAM,KAAK,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SACzC;aAAM,IAAI,MAAM,CAAC,UAAU,IAAI,IAAI,CAAC,MAAM,EAAE;YAC3C,MAAM,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SACvC;QACD,OAAO,IAAI,CAAC,MAAM,CAAC;IACrB,CAAC;IAED,gBAAgB,CAAC,QAAyB;QACxC,IAAI,IAAI,CAAC,aAAa,EAAE;YACtB,QAAQ,CAAC,eAAe,CAAC,IAAI,CAAC,aAAa,EAAE;gBAC3C,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,UAAU,EAAE;aACjC,CAAC,CAAC;SACJ;QACD,IAAI,CAAC,SAAS,EAAE,YAAY,CAAC;YAC3B,KAAK,EAAE,IAAI,CAAC,SAAS;YACrB,IAAI,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAC,QAAQ,EAAE,IAAI,EAAC,CAAC;SAC5C,CAAC,CAAC;IACL,CAAC;IAED,KAAK,CAAC,SAAS;QACb,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACzD,OAAO,MAAuB,CAAC;IACjC,CAAC;IAED,UAAU;QACR,OAAO,IAAI,CAAC,QAAQ,CAAC;YACnB,MAAM,EAAE,IAAI;YACZ,QAAQ,EAAE,IAAI;SACf,CAAC,CAAC;IACL,CAAC;IAED,aAAa,CAAC,KAAwB;QACpC,IAAI,IAAI,CAAC,aAAa,EAAE;YACtB,KAAK,CAAC,kBAAkB,CAAC,WAAW,CAAC,UAAU,EAAE;gBAC/C,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,EAAE;gBAChC,KAAK,EAAE,IAAI,CAAC,SAAS;aACtB,CAAC,CAAC;SACJ;IACH,CAAC;IAED,mBAAmB,CAAC,WAA+B;QACjD,IAAI,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE;YACvD,WAAW,CAAC,kBAAkB,CAAC;gBAC7B,OAAO,EAAE,IAAI,CAAC,aAAa,CAAC,EAAE;gBAC9B,UAAU,EAAE,IAAI,CAAC,OAAO,CAAC,gBAAgB;aAC1C,CAAC,CAAC;SACJ;IACH,CAAC;CACF,CAAA;AApHwB;IAAtB,MAAM,CAAC,aAAa,CAAC;+DAAiD;AAC7C;IAAzB,MAAM,CAAC,gBAAgB,CAAC;uDAA4C;AAErE;IADC,MAAM,CAAC,gBAAgB,CAAC;IAAE,QAAQ,EAAE;2DACU;AAN3B,wBAAwB;IAD7C,UAAU,EAAE;GACS,wBAAwB,CAuH7C;SAvHqB,wBAAwB","file":"../../../src/browser/shell/view-contribution.js","sourcesContent":["/********************************************************************************\n * Copyright (C) 2018 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\nimport {inject, injectable, interfaces, optional} from 'inversify';\nimport {Widget} from '@lumino/widgets';\nimport {Command, CommandContribution, CommandRegistry, MenuContribution, MenuModelRegistry} from '../../common';\nimport {KeybindingContribution, KeybindingRegistry} from '../keybinding';\nimport {WidgetManager} from '../widget-manager';\nimport {CommonMenus} from '../common-frontend-contribution';\nimport {ApplicationShell} from './application-shell';\nimport {QuickViewService} from '../quick-input';\n\nexport interface OpenViewArguments extends ApplicationShell.WidgetOptions {\n  toggle?: boolean\n  activate?: boolean;\n  reveal?: boolean;\n}\n\nexport interface ViewContributionOptions {\n  widgetId: string;\n  viewContainerId?: string;\n  widgetName: string;\n  defaultWidgetOptions: ApplicationShell.WidgetOptions;\n  toggleCommandId?: string;\n  toggleKeybinding?: string;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function bindViewContribution<T extends AbstractViewContribution<any>>(bind: interfaces.Bind, identifier: interfaces.Newable<T>): interfaces.BindingWhenOnSyntax<T> {\n  const syntax = bind<T>(identifier).toSelf().inSingletonScope();\n  bind(CommandContribution).toService(identifier);\n  bind(KeybindingContribution).toService(identifier);\n  bind(MenuContribution).toService(identifier);\n  return syntax;\n}\n\n/**\n * An abstract superclass for frontend contributions that add a view to the application shell.\n */\n@injectable()\nexport abstract class AbstractViewContribution<T extends Widget> implements CommandContribution, MenuContribution, KeybindingContribution {\n\n  readonly toggleCommand?: Command;\n  @inject(WidgetManager) protected readonly widgetManager: WidgetManager;\n  @inject(ApplicationShell) protected readonly shell: ApplicationShell;\n  @inject(QuickViewService) @optional()\n  protected readonly quickView: QuickViewService;\n\n  constructor(\n      protected readonly options: ViewContributionOptions\n  ) {\n    if (options.toggleCommandId) {\n      this.toggleCommand = {\n        id: options.toggleCommandId,\n        label: 'Toggle ' + this.viewLabel + ' View'\n      };\n    }\n  }\n\n  get viewId(): string {\n    return this.options.widgetId;\n  }\n\n  get viewLabel(): string {\n    return this.options.widgetName;\n  }\n\n  get defaultViewOptions(): ApplicationShell.WidgetOptions {\n    return this.options.defaultWidgetOptions;\n  }\n\n  get widget(): Promise<T> {\n    return this.widgetManager.getOrCreateWidget(this.viewId);\n  }\n\n  tryGetWidget(): T | undefined {\n    return this.widgetManager.tryGetWidget(this.viewId);\n  }\n\n  async openView(args: Partial<OpenViewArguments> = {}): Promise<T> {\n    const shell = this.shell;\n    const widget = await this.widgetManager.getOrCreateWidget(this.options.viewContainerId || this.viewId);\n    const tabBar = shell.getTabBarFor(widget);\n    const area = shell.getAreaFor(widget);\n    if (!tabBar) {\n      // The widget is not attached yet, so add it to the shell\n      const widgetArgs: OpenViewArguments = {\n        ...this.defaultViewOptions,\n        ...args\n      };\n      await shell.addWidget(widget, widgetArgs);\n    } else if (args.toggle && area && shell.isExpanded(area) && tabBar.currentTitle === widget.title) {\n      // The widget is attached and visible, so collapse the containing panel (toggle)\n      switch (area) {\n        case 'left':\n        case 'right':\n          await shell.collapsePanel(area);\n          break;\n        case 'bottom':\n          // Don't collapse the bottom panel if it's currently split\n          if (shell.bottomAreaTabBars.length === 1) {\n            await shell.collapsePanel('bottom');\n          }\n          break;\n        default:\n          // The main area cannot be collapsed, so close the widget\n          await this.closeView();\n      }\n      return this.widget;\n    }\n    if (widget.isAttached && args.activate) {\n      await shell.activateWidget(this.viewId);\n    } else if (widget.isAttached && args.reveal) {\n      await shell.revealWidget(this.viewId);\n    }\n    return this.widget;\n  }\n\n  registerCommands(commands: CommandRegistry): void {\n    if (this.toggleCommand) {\n      commands.registerCommand(this.toggleCommand, {\n        execute: () => this.toggleView()\n      });\n    }\n    this.quickView?.registerItem({\n      label: this.viewLabel,\n      open: () => this.openView({activate: true})\n    });\n  }\n\n  async closeView(): Promise<T | undefined> {\n    const widget = await this.shell.closeWidget(this.viewId);\n    return widget as T | undefined;\n  }\n\n  toggleView(): Promise<T> {\n    return this.openView({\n      toggle: true,\n      activate: true\n    });\n  }\n\n  registerMenus(menus: MenuModelRegistry): void {\n    if (this.toggleCommand) {\n      menus.registerMenuAction(CommonMenus.VIEW_VIEWS, {\n        commandId: this.toggleCommand.id,\n        label: this.viewLabel\n      });\n    }\n  }\n\n  registerKeybindings(keybindings: KeybindingRegistry): void {\n    if (this.toggleCommand && this.options.toggleKeybinding) {\n      keybindings.registerKeybinding({\n        command: this.toggleCommand.id,\n        keybinding: this.options.toggleKeybinding\n      });\n    }\n  }\n}\n"]}